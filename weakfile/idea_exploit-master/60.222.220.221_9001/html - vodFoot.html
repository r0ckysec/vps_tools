<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=8">
		<title>点播观看记录</title>
		<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
		<script type="text/javascript" src="js/dialog.js"></script>
		<script type="text/javascript" src="js/common.js"></script>
		<script type="text/javascript" src="js/cookie.js"></script>
		<link href="css/vodfoot.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="css/dialog.css">
	</head>

	<body>
		<form name="form1" method="post" action="" id="form1">
			<div class="Contenter">
				<div class="title">
					<div class="title_left">
						<div class="title_left_img">
							<img src="images/62.png" border="0">
						</div>
					</div>
					<div class="title_right">
						<div class="title_font" style="float: left;">
							点播观看记录
						</div>
						<div class="clearall">
							<a style="cursor: pointer;" onclick="clearRecord()">清空我的观看记录</a>
						</div>
						<div class="clear"></div>
					</div>
					<div class="clear">
					</div>
				</div>
				<div class="content">
					<div class="content_list">
						<div class="content_list_title">
							<img src="images/64.jpg" class="middle" border="0">
							<img src="images/62.png" class="middle_left" border="0">
						</div>
						<div class="content_list_content" id="main_body">

						</div>
					</div>
				</div>
			</div>
		</form>
		<script>
			$("document").ready(function () {
				$(".content_list_content li").hover(function () {
					var dom1 = $(this).find("div:first");
					var dom2 = $(this).find("div:last");
					if (dom1.attr("class") == "content_list_content_left") {
						$(dom1).removeClass("content_list_content_left");
						$(dom1).addClass("content_list_content_left_on");
					}
					if (dom2.attr("class") == "content_list_content_right") {
						$(dom2).removeClass("content_list_content_right");
						$(dom2).addClass("content_list_content_right_on");
					}
				}, function () {
					var dom1 = $(this).find("div:first");
					var dom2 = $(this).find("div:last");
					if (dom1.attr("class") == "content_list_content_left_on") {
						$(dom1).removeClass("content_list_content_left_on");
						$(dom1).addClass("content_list_content_left");
					}
					if (dom2.attr("class") == "content_list_content_right_on") {
						$(dom2).removeClass("content_list_content_right_on");
						$(dom2).addClass("content_list_content_right");
					}
				});
			});

			var imgName = "../images/video.jpg";
			var currentPage = 1;
			$(function(){
				$.ajax({
					type: "GET",
					url: locationHref+"/rest/client/clientUsers/"+user_id+"/////recordWatch",//获取用户浏览记录
					success:function(data, textStatus, request)
					{
						var obj = data;
						if(obj != null)
						{
							var items = obj.items;
							var total = obj.total;
							if(items != null)
							{
								for(var i=0;i<items.length;i++)
								{
									var fileUrl = decodeURI(decodeURI(items[i].fileUrl));
									var typeId = items[i].typeId;
									var beforeFlag = items[i].flag;
									var beforePage = items[i].page;
									var fileId = items[i].fileId;
									var thumbUrl = "";
									if(items[i].thumbUrl != undefined)
									{
										thumbUrl = replace_url(items[i].thumbUrl);
									}
									var name = fileUrl.substr(fileUrl.lastIndexOf("/")+1,fileUrl.length);
									name = name.substr(0,name.lastIndexOf("."));

									var dom = '<ul>';
									dom += '<li>';
									dom += '<div class="pointerimg" value="30">';
									dom += '<a target="playerwin" href="/html/vodInfo.html?cateId='+typeId+'&flag='+beforeFlag+'&allName='+fileId+'&page='+beforePage+'" title="">';//分类id,文件ID,当前页
									dom += '<img src="'+thumbUrl+'" onerror="this.src=\''+imgName+'\'" class="imgborder" height="72px" width="128px">';
									dom += '</a>';
									dom += '</div>';
									dom += '<div class="packname" style="padding-left: 8px;overflow: hidden;width: 140px;height: 20px;word-wrap:break-word;word-break:break-all;">';
									dom += '<a target="playerwin" href="/" title="'+name+'">';
									dom += ''+name+'';
									dom += '</a>';
									dom += '</div>';
									dom += '</li>';
									dom += '</ul>';

									$("#main_body").append(dom);
								}
							}
						}
					},
					error:function(data)
					{

					}
				})
			})


			function clearRecord()
			{
				$.ajax({
					type: "DELETE",
					url: locationHref+"/rest/client/clientUsers/"+user_id+"///delete",//获取用户浏览记录
					success:function(data, textStatus, request)
					{
						window.location.reload();
					}
				})
			}


			function replace_url(url)
			{
				var host = window.location.hostname;
				var before = url.substr(0,url.indexOf("//")+2);
				var after = "";

				if(url.substring(before.length).lastIndexOf(":") != -1)
				{
					after = url.substr(url.lastIndexOf(":"));
				}
				else
				{
					var temp = url.substring(before.length);
					after = temp.substring(temp.indexOf("/"));
				}

				return (before+host+after);
			}
		</script>
	</body>
</html>