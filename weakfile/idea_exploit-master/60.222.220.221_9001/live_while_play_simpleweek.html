<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>直播编排</title>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">

	<!--<link rel="stylesheet" href="css/main.css">-->
	<link href="css/sp.css" rel="stylesheet" type="text/css" />
	<link href="css/reset.css" rel="stylesheet" type="text/css" />
	<link href="css/system.css" rel="stylesheet" type="text/css" />
	<link href="css/table_form.css" rel="stylesheet" type="text/css" />
	<link href="css/dialog.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="js/dialog/jquery.ui.all.css"/>

	<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.bgiframe-2.1.2.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.core.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.mouse.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.draggable.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.position.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.resizable.js"></script>
	<script type="text/javascript" src="js/dialog/jquery.ui.dialog.js"></script>
	<script type="text/javascript" src="js/ref_encode.js"></script>
	<script type="text/javascript" src="js/admin_common.js"></script>
	<script type="text/javascript" src="js/jquery.form.js"></script>
	<script type="text/javascript" src="js/encoder.js" ></script>
	<script type="text/javascript" src="js/time.js" ></script>
	<script type="text/javascript" src="js/cookie.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
	<script type="text/javascript" src="js/add_edit_live.js"></script>
	<script type="text/javascript" src="js/bean.js"></script>
	<script type="text/javascript" src="js/timeTrans.js"></script>
	<script type="text/javascript" src="js/excel.js"></script>
	<style type="text/css">
		.weekStatus
		{
			display: none;
		}
		.title{height:20px}
		.title .t{width: 70px;text-align: center;}
		.title .i{width:323px;text-align:center}
		.item{height:30px;width:1000px;}
		.item a{display:block;float:left;margin-right:5px; width:23px;height:23px;background:#ededed;border:1px solid #e0e0e0;cursor:pointer;text-align:center;line-height: 23px;font-size:18px;font-weight: bold;}
		.item a:hover{text-decoration:none;}
		.f{float: left;}
		.c{text-align: center}
		.fname{display:block;width:75px;height:25px;line-height:25px;float:left;margin-left:26px;text-align:center;}
		.ftstart{display:block;width:65px;height:25px;line-height:25px;float:left;text-align:center;}
		.id{display:block;width:185px;height:25px;line-height:25px;float:left;text-align:center;}
		.startTime{display:block;width:75px;height:25px;line-height:25px;float:left;text-align:center;}
		.stopTime{display:block;width:75px;height:25px;line-height:25px;float:left;text-align:center;}
		.fpath{display:block;width:300px;height:25px;line-height:25px;float:left;text-align:center;}
		.ftime{display:block;width:110px;height:25px;line-height:25px;float:left;text-align:center;}
		.item-name{width:200px;}
		.item-path{width:300px;}
		.item-time{width:110px;}
		.item-type{width:60px;}
		.item-startTime{width:60px;}
		.item-stopTime{width:60px;}
		.ui-dialog-titlebar{
			background: rgba(0, 0, 0, 0) -moz-linear-gradient(center top , #3580cf, #85b2e3) repeat scroll 0 0;
			box-shadow: none;
			border:none;
			color:#fff;
			border-bottom-style: none;
			background:url('js/dialog/dialog/images/dialog_bar_bg.jpg') repeat-x;
		}
	</style>
	<script type="text/javascript">
		var FLV_FileIsNotAllowedToEmpty ; //  FLV 文件不允许为空 !
		var VideoStartTimeFormatIsNotCorrect ; //  视频开始时间格式不正确
		var VideoDurationIsNotCorrect ; //  视频持续时间格式不正确
		var FailedToGetData ; // 获取数据失败
		var DataNotEmpty;
		var SelectVideo ; // 选择视频
		var Add ; // 添加
		var UpwardShift ; // 上移
		var DownwardMovement ; // 下移
		var Remove ; // 移除
		var SelectMedia ;// 选择媒体
		var objSub ="";
		var openStatus;
		var getresolution = "-1";
		var maxId = 0;
		var allItemsSimple;
		var host = window.location.hostname;
		var port = window.location.port;
		(function($){
			$.getUrlParam = function(name)
			{
				var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if (r!=null) return unescape(r[2]); return null;
			};
		})(jQuery);

		var select_tab_val;
		//获取之后几天
		function tab(dayNum){
			//var oDate = new Date();   //获取当前时间
			var now = new Date();		//获取当前时间
			var oDate=new Date(now - (now .getDay() - 1 ) * 86400000);	//获取本周第一天
			select_tab_val = getCurrentTime(oDate);
			var dayArr = new Array();     //定义一个数组存储所以时间
			for(var i=0;i<dayNum;i++){
				dayArr.push(new Date(oDate.getFullYear(),oDate.getMonth(),oDate.getDate() + i));   //把未来几天的时间放到数组里
			}
			return dayArr;   //返回一个数组。
		}

		var whileLiveId = $.getUrlParam("id");
		var whileRight = $.getUrlParam("right");
		var EditList;
		var AddList
		var Delete;
		var Edit;
		var PlayingNow;
		var Manualmode;
		var Timingmode;
		var Topplayer;

		var Name;
		var StartTime;
		var EndTime;
		var Type;
		var VideoDuration;
		var VideoPath;
		var Save;
		var Sunday;
		var Monday;
		var Tuesday;
		var Wednesday;
		var Thursday;
		var Friday;
		var Saturday;
		$(function(){
			Init_license(authorization);
			$.ajaxSetup({ cache: false });
			var Languages = $.cookie('internationalization');
			if ( Languages == null || Languages == "" )
			{
				Languages = 'zh' ;
			}
			jQuery.i18n.properties({
				name : 'strings', //资源文件名称
				path : '/i18n/', //资源文件路径
				mode : 'map', //用Map的方式使用资源文件中的值
				language : Languages,
				encoding : 'UTF-8', // 必须写 否则中文乱码
				callback : function() {//加载成功后设置显示内容
					$('#OpenTranscoding').html($.i18n.prop('VideoTranscoding'));
					$('#open_Transfer').html($.i18n.prop('Open'));
					$('#close_1').html($.i18n.prop('Close'));
					$('#open_1').html($.i18n.prop('Open'));
					$('#close_Transfer').html($.i18n.prop('Close'));
					$('#transfer_button').val($.i18n.prop('CarouselConfiguration'));
					$('#cli_button').val($.i18n.prop('SliceConfiguration'));
					$('#video_path').html($.i18n.prop('VideoPath'));
					$('#SelectVideo').val($.i18n.prop('VideoOnDemand'));
					$('#add').attr("title",$.i18n.prop('Add'));
					$('#Remove').attr("title",$.i18n.prop('Remove'));
					$('#Upward').attr("title",$.i18n.prop('UpwardShift'));
					$('#down').attr("title",$.i18n.prop('DownwardMovement'));
					$("#addList").html($.i18n.prop('AddList'));
					$("#sort").val($.i18n.prop('Topplayer'))
					$("#mydialogform").val($.i18n.prop('Determine'));
					$("#mydialogform_1").val($.i18n.prop('Cancel'));
					$('#back').html($.i18n.prop('Back'));
					$('#save').val($.i18n.prop('Save'));
					FLV_FileIsNotAllowedToEmpty = $.i18n.prop('FLV_FileIsNotAllowedToEmpty') ;
					VideoStartTimeFormatIsNotCorrect = $.i18n.prop('VideoStartTimeFormatIsNotCorrect') ;
					VideoDurationIsNotCorrect = $.i18n.prop('VideoDurationIsNotCorrect') ;
					FailedToGetData = $.i18n.prop('FailedToGetData') ;
					SelectVideo = $.i18n.prop('SelectVideo') ;
					SelectMedia = $.i18n.prop('SelectMedia') ;
					Delete = $.i18n.prop('Delete') ;
					AddList = $.i18n.prop('AddList') ;
					EditList = $.i18n.prop('EditList') ;
					Edit = $.i18n.prop('Edit') ;
					PlayingNow = $.i18n.prop('PlayingNow') ;
					Manualmode = $.i18n.prop('Manualmode') ;
					Timingmode = $.i18n.prop('Timingmode') ;
					Topplayer =  $.i18n.prop('Topplayer') ;
					DataNotEmpty = $.i18n.prop('DataNotEmpty') ;
					Name = $.i18n.prop('Name');
					StartTime = $.i18n.prop('StartTime');
					EndTime = $.i18n.prop('EndTime');
					Type = $.i18n.prop('Type');
					VideoDuration = $.i18n.prop('VideoDuration');
					VideoPath = $.i18n.prop('VideoPath');
					Save = $.i18n.prop('Save');

					Sunday = $.i18n.prop('Sunday');
					Monday = $.i18n.prop('Monday');
					Tuesday = $.i18n.prop('Tuesday');
					Wednesday = $.i18n.prop('Wednesday');
					Thursday = $.i18n.prop('Thursday');
					Friday = $.i18n.prop('Friday');
					Saturday = $.i18n.prop('Saturday');

				}
			});


			$.ajax({
				 type:"GET",
				 url:locationHref+"/rest/admin/lives/"+whileLiveId+'/lunbo/oneList',//获取一个轮播任务
				 success: function (data)
				 {
					 objSub = data;
					 var obj = data;
					 if(objSub.transfId == "-1" || objSub.transfId == "")
					 {
						 openStatus = false;
					 }
					//init_whole_page(data,j);
					//checkA(openStatus);
					var array = tab(7);
					for(var j=0;j<array.length;j++)
					{
						var current = getCurrentTime(array[j]);
						var li_dom = '';
						var j_str = Monday;
						if(j < 7)
						{
							if(j == 0)
							{
								li_dom = '<li class="on" onclick="SwapTab(\'setting\',\'on\',\'\',\''+array.length+'\',\''+j+'\',\''+current+'\');" weekTime="'+current+'" id="tab_setting_'+j+'">'+j_str+'</li>';
							}
							else
							{
								if(j == 1)
								{
									j_str = Tuesday;
								}
								else if(j == 2)
								{
									j_str = Wednesday;
								}
								else if(j == 3)
								{
									j_str = Thursday;
								}
								else if(j == 4)
								{
									j_str = Friday;
								}
								else if(j == 5)
								{
									j_str = Saturday;
								}
								else if(j == 6)
								{
									j_str = Sunday;
								}
								li_dom = '<li onclick="SwapTab(\'setting\',\'on\',\'\',\''+array.length+'\',\''+j+'\',\''+current+'\');" weekTime="'+current+'" id="tab_setting_'+j+'">'+j_str+'</li>';
							}
						}
						$("#week_li").append(li_dom);

						var div_dom = '';
						if(j == 0)
						{
							div_dom += '<div class="contentList pad-10" id="div_setting_'+j+'">';
						}
						else
						{
							div_dom += '<div class="contentList hidden pad-10" id="div_setting_'+j+'">';
						}
						div_dom += '<table width="100%" class="table_form">';
						div_dom += '<tbody>';
						div_dom += '<tr>';
						div_dom += '<td colspan="2">';
						div_dom += '<div style="float: left">';
						div_dom += '<span class="id" id="td_4">'+Name+'</span>';
						div_dom += '<span class="startTime" id="td_5">'+StartTime+'</span>';
						div_dom += '<span class="stopTime" id="td_6">'+EndTime+'</span>';
						div_dom += '<span class="ftstart" id="video_start">'+Type+'</span>';
						div_dom += '<span class="fpath" id="video_path">'+VideoPath+'</span>';
						div_dom += '<span class="ftime" id="video_duration">'+VideoDuration+'</span>';
						div_dom += '</div>';
						div_dom += '<div id="items">';
						div_dom += '<div id="main_body_'+j+'">';
						div_dom += '<div class="item">';
						div_dom += '<div class="f c">';
						div_dom += '<input type="hidden" id="itemid" value="0" size="10" class="input-text" readonly="readonly"/>';
						div_dom += '<input type="text" id="itemname" value="" size="30" class="input-text item-name"/>';
						div_dom += '<input type="text" id="itemStartTime" value="00:00:00" size="10" class="input-text item-startTime"/>';
						div_dom += '<input type="text" id="itemStopTime" value="" size="10" class="input-text item-stopTime"/>';
						div_dom += '<input type="text" name="type" value="file" size="10" class="input-text item-type"  style="background-color: #90a2bc;" readonly="readonly">';
						div_dom += '<input type="text" id="flv" name="flv" class="input-text item-path" value="" size="50" readonly="readonly">';
						div_dom += '<input type="hidden" id="flv1" name="flv1" class="input-text item-path" value="" size="50">';
						div_dom += '<input type="text" id="time" name="time" class="input-text item-time" value="" size="15" readonly="readonly">';
						div_dom += '<input type="button" class="button"  onclick="chooseDialog_simple(this,\''+j+'\')" id="selectVideo" value="'+SelectVideo+'" style="margin-left:18px;"/><br/>';
						div_dom += '</div>';
						div_dom += '<a href="javascript:;" onclick="m_add_simple(this,'+j+')" name="add" title="添加" id="add">+</a>';
						div_dom += '<a href="javascript:;" onclick="m_remove_simple(this)" title="移除" id="Remove">-</a>';
						div_dom += '</div>';
						div_dom += '<input type="button" class="button" onclick="addWhileWeekList('+j+')" value="'+Save+'" style="margin-left:820px;"/>';
						div_dom += '</div>';
						div_dom += '</div>';
						div_dom += '</td>';
						div_dom += '</tr>';
						div_dom += '</tbody>';
						div_dom += '</table>';
						div_dom += '</div>';
						$("#week_li").after(div_dom);
						init_whole_page(obj,j,current);
					}

				},
				error:function(data)
				{
					var errorObj = data;
					var status = data.status;
					var statusText = data.statusText
					if(status == 401 || status == 400)
					{
						top.location.href = "login.html";
					}
					else if(status == 409)
					{
						window.top.art.dialog({id:"mesg",content:statusText+"!",time:2});
					}
				}
			})
		});

		function init_whole_page(obj,index,current)
		{
			var object = obj;
			var tran = object.transfId;
			var type = object.type;
			var mode = object.mode;
			var mvlist = object.mvlist;
			if(mvlist != undefined)
			{
				allItemsSimple = mvlist;
				var dom = "";
				for(var j=0;j<mvlist.length;j++)
				{
					var week = mvlist[j].week;
					var date = mvlist[j].date;
					var dayLoop = mvlist[j].dayLoop;
					var items = mvlist[j].items;
					var listId;
					if(week == index)
					{
						listId = mvlist[j].listId;
						if(items != '')
						{
							for(var k=0;k<items.length;k++)
							{
								var mvId = parseInt(items[k].id);
								if(mvId > maxId)
								{
									maxId = mvId;
								}
								var mvName = items[k].name;
								var mvType = items[k].type;
								var mvValue = items[k].value;
								var mvValue_show = mvValue.substr(mvValue.lastIndexOf("/")+1,mvValue.length);
								var mvTime = items[k].duration;
								var startTime = items[k].startTime;
								var stopTime = items[k].stopTime;
								dom+= '<div class="item">';
								dom+= '<div class="f c">';
								dom+= '<input type="hidden" id="itemid" value="'+mvId+'" size="10" class="input-text" readonly="readonly"/>';
								dom+= '<input type="text" id="itemname" value="'+mvName+'" size="30" class="input-text item-name"/>';
								dom+= '<input type="text" id="itemStartTime" value="'+startTime+'" size="10" class="input-text item-startTime"/>';
								dom+= '<input type="text" id="itemStopTime" value="'+stopTime+'" size="10" class="input-text item-stopTime"/>';
								dom+= '<input type="text" id="type" name="type" value="'+mvType+'" size="10" class="input-text item-type" readonly="readonly" style="background-color: #90a2bc;">';
								dom+= '<input type="text" id="flv" name="flv[]" class="input-text item-path" value="'+mvValue_show+'" readonly size="50">';
								dom+= '<input type="hidden" id="flv1" name="flv1" class="input-text item-path" value="'+mvValue+'" size="50">';
								dom+= '<input type="text" id="time" name="time" class="input-text item-time" value="'+mvTime+'" readonly size="15">';
								//dom+= '<input type="button" class="button"  onclick="chooseDialog_simple(this,\''+tran+'\',\''+mvValue+'\')" id="SelectVideo"  value="'+SelectVideo+'" style="margin-left:18px;"/><br/>';
								dom+= '<input type="button" class="button"  onclick="chooseDialog_simple(this,\''+index+'\')" id="SelectVideo"  value="'+SelectVideo+'" style="margin-left:18px;"/><br/>';
								dom+= '</div>';
								dom+= '<a href="javascript:;" onclick="m_add_simple(this,\''+index+'\')" name="add" title="添加" id="add">+</a>';
								dom+= '<a href="javascript:;" onclick="m_remove_simple(this)" title="移除" id="Remove">-</a>';
								dom+= '</div>';
							}
						}
						else
						{
							dom+= '<div class="item">';
							dom+= '<div class="f c">';
							dom+= '<input type="hidden" id="itemid" value="0" size="10" class="input-text" readonly="readonly"/>';
							dom+= '<input type="text" id="itemname" value="" size="30" class="input-text item-name"/>';
							dom+= '<input type="text" id="itemStartTime" value="00:00:00" size="10" class="input-text item-startTime"/>';
							dom+= '<input type="text" id="itemStopTime" value="" size="10" class="input-text item-stopTime"/>';
							dom+= '<input type="text" id="type" name="type" value="file" size="10" class="input-text item-type" readonly="readonly" style="background-color: #90a2bc;">';
							dom+= '<input type="text" id="flv" name="flv[]" class="input-text item-path" value="" readonly size="50">';
							dom+= '<input type="hidden" id="flv1" name="flv1" class="input-text item-path" value="" size="50">';
							dom+= '<input type="text" id="time" name="time" class="input-text item-time" value="" readonly size="15">';
							//dom+= '<input type="button" class="button"  onclick="chooseDialog_simple(this,\''+tran+'\',\''+mvValue+'\')" id="SelectVideo"  value="'+SelectVideo+'" style="margin-left:18px;"/><br/>';
							dom+= '<input type="button" class="button"  onclick="chooseDialog_simple(this,\''+index+'\')" id="SelectVideo"  value="'+SelectVideo+'" style="margin-left:18px;"/><br/>';
							dom+= '</div>';
							dom+= '<a href="javascript:;" onclick="m_add_simple(this,\''+index+'\')" name="add" title="添加" id="add">+</a>';
							dom+= '<a href="javascript:;" onclick="m_remove_simple(this)" title="移除" id="Remove">-</a>';
							dom+= '</div>';
						}
						dom += '<input type="button" class="button"  onclick="addWhileWeekList('+index+',\''+listId+'\',\''+current+'\')" value="'+Save+'" style="margin-left:820px;"/>';
						dom += '<input type="button" class="button"  onclick="exportWhileSimple('+index+')" value="导出" style="margin-left:10px;"/>';
						$("#main_body_"+index).html(dom);
					}
				}
			}
			changeTimeForWhile_simple(index);
			var weekCurrentTab = getcookie('WeekCurrentTab');
			var weekCurrentTime = getcookie('WeekCurrentTime');
			var weekSave = getcookie('WeekSave');
			if (weekCurrentTab != null && weekCurrentTime != undefined && weekSave == "Save")
			{
				SwapTab('setting','on','',7,weekCurrentTab,weekCurrentTime);
			}
			else
			{
				var newDate = new Date();
				var currentDay = newDate.getDay();
				var currentDay_str;
				if(currentDay == 0)
				{
					currentDay_str = 6;
				}
				else if(currentDay == 1)
				{
					currentDay_str = 0;
				}
				else if(currentDay == 2)
				{
					currentDay_str = 1;
				}
				else if(currentDay == 3)
				{
					currentDay_str = 2;
				}
				else if(currentDay == 4)
				{
					currentDay_str = 3;
				}
				else if(currentDay == 5)
				{
					currentDay_str = 4;
				}
				else if(currentDay == 6)
				{
					currentDay_str = 5;
				}
				var currentDate = getCurrentTime(newDate);
				SwapTab('setting','on','',7,currentDay_str,currentDate);
			}
		}

		function checkA(status) {
			if (openStatus == "false") {
				$("#asize").hide();
			}
		}

		function whileBack()
		{
			if(whileRight == "4")
			{
				redirect('live_while_list.html');
			}
		}

		function m_add_simple(obj,index)
		{
			maxId += 1;
			var content = $("#main_body_"+index).find(".item").first().clone();
			$(content).find("input[type='text']").val("");
			$(content).find("input[name='type']").val("file");
			$(content).find("input[name='time']").val("");
			$(content).find("input[type='button']").show();
			$(content).find("input[id='itemid']").val(maxId);
			$(obj).parent("div").after(content);
		}
		function m_remove_simple(obj)
		{
			var id =  $(obj).parent("div").parent("div").attr("id");
			//if(id != "templ")
			{
				$(obj).parent("div").remove();
			}
		}

		function changeTimeForWhile_simple(index)
		{
			$("#main_body_"+index).find(".item").each(function(i){
				var startTime = $(this).find("div").find(".item-startTime").val();
				var mediaTime= $(this).find("div").find(".item-time").val();
				if(mediaTime != null && mediaTime != "")
				{
					var stopTime = formatSecond(parseSecond(startTime) + parseSecond(mediaTime));
					$(this).find("div").find(".item-stopTime").val(stopTime);
					$(this).next(".item").find("div").find(".item-startTime").val(stopTime);
				}
			})
			var stopTime_flag = 0;
			$("#main_body_"+index).find(".item").each(function(i){
				var stopTime = parseSecond($(this).find("div").find(".item-stopTime").val());
				if(!isNaN(stopTime))
				{
					if(stopTime> stopTime_flag)
					{
						stopTime_flag = stopTime;
					}
				}
				if(stopTime_flag > 86399)
				{
					$("#main_body_"+index).find(".item").each(function(i){
						$(this).find("a[name='add']").hide();
					})
					$(this).find("div").find(".item-stopTime").val("23:59:59");
				}
				else
				{
					$("#main_body_"+index).find(".item").each(function(i){
						$(this).find("a[name='add']").show();
					})
				}
			})
		}

		var path_url = "";
		//选择视频
		function chooseDialog_simple(obj,index)
		{
			window.top.art.dialog
			(
					{
						id:'choose',iframe:"/media_while_choose.html?type="+openStatus+"&path="+encodeURI(encodeURI(path_url)), title:SelectVideo, width:'800', height:'520', lock:true
						//id:'choose',iframe:"/media_while_choose.html?type="+openStatus, title:'选择视频', width:'800', height:'520', lock:true
					},
					function()
					{
						var d = window.top.art.dialog({id:'choose'}).data.iframe;
						var form = d.document.getElementById('dosubmit');
						form.click();
						var mediapath = d.document.getElementById('media_path').value;
						var check_flag = d.document.getElementById('check_flag').value;
						var mediatime = d.document.getElementById('media_time').value;
						if(mediapath !=null && mediapath!="" && check_flag == "true")
						{
							path_url = mediapath;
							var itemvalue_show = mediapath.substr(mediapath.lastIndexOf('/')+1,mediapath.length);
							var itemname_show = itemvalue_show.substr(0,itemvalue_show.lastIndexOf('.'))
							$(obj).prev("input").prev("input").prev("input").prev("input").prev("input").prev("input").prev('input').val(itemname_show);//别名显是
							$(obj).prev("input").prev("input").prev("input").val(itemvalue_show);//显示视频路径赋值
							$(obj).prev("input").prev("input").val(mediapath);//视频全路径赋值
							$(obj).prev("input").val(mediatime);//视频时间

							changeTimeForWhile_simple(index);
							window.top.art.dialog({id:'choose'}).close();
						}

						return false;
					},
					function()
					{
						window.top.art.dialog({id:'24fsf5'}).close()
					}
			);void(0);
		}


		function addWhileWeekList(index,listId,current)
		{
			var flag = true;
			var listItem = objSub;
			var transfId = listItem.transfId;
			var whileType = listItem.type;
			var whileMode = listItem.mode;
			var mvlist = listItem.mvlist;
			var itemId,itemname,type,value,media_time,itemStartTime,itemStopTime;
			var arr = new Array();
			$("#main_body_"+index).find(".item").each(function(e) {
				$(this).find("input").each(function (f) {
					if (f == 0) {
						itemId = $(this).val();
					}
					else if (f == 1) {
						itemname = $(this).val();
					}
					else if(f == 2){
						itemStartTime = $(this).val();
					}
					else if(f == 3){
						itemStopTime = $(this).val();
					}
					else if (f == 4) {
						type = $(this).val();
					}
					else if (f == 6) {
						value = $(this).val();
						if(value == "")
						{
							flag = false;
						}
					}
					else if(f == 7)
					{
						media_time = $(this).val();
					}
				})
				//var items = new ItemsWhilePlay(itemId,itemname,type,value,media_time);
				var items = new ItemsWhilePlayInfo(itemId,itemname,type,value,media_time,itemStartTime,itemStopTime);
				arr[e] = items;
			})

			var mvMaxID = 0;
			var mvlistInfo;
			if(arr != "")
			{
				mvlist = new Array();
				if(listId != undefined && listId != "")
				{
					mvlistInfo = new MvListTime(index,'',false,arr,listId);
				}
				else
				{
					mvlistInfo = new MvListTime_noId(index,'',false,arr);
				}
				mvlist[0] = mvlistInfo;
			}
			else
			{
				mvlist = new Array();
				mvlistInfo = new MvListTime(index,'',false,arr,listId);
				mvlist[0] = mvlistInfo;
			}
			var listItemSub = new PlayWhileItem(mvlist,transfId,whileType,whileMode);

			//alert(stringify(listItemSub));
			if(arr == "")
			{
				$.ajax({
					type:"PUT",
					url:locationHref+"/rest/admin/lives/"+whileLiveId+'/lunbo/oneList',//编辑一个直播频道
					async: false,
					data: stringify(listItemSub),
					dataType:"json",
					success:function(data)
					{
						setcookie("WeekCurrentTab",index,30);
						setcookie("WeekCurrentTime",current,30);
						setcookie("WeekSave","Save",30);
						window.location.reload();
					},
					error:function(data)
					{
						var errorObj = data;
						var status = data.status;
						var statusText = data.statusText
						if(status == 401 || status == 400)
						{
							top.location.href = "login.html";
						}
						else if(status == 409)
						{
							window.top.art.dialog({id:"mesg",content:statusText+"!",time:2});
						}
					}

				});
			}
			else
			{
				if(flag == true && arr.length != 0)
				{
					$.ajax({
						type:"PUT",
						url:locationHref+"/rest/admin/lives/"+whileLiveId+'/lunbo/oneList',//编辑一个直播频道
						async: false,
						data: stringify(listItemSub),
						dataType:"json",
						success:function(data)
						{
							setcookie("WeekCurrentTab",index,30);
							setcookie("WeekCurrentTime",current,30);
							setcookie("WeekSave","Save",30);
							window.location.reload();
						},
						error:function(data)
						{
							var errorObj = data;
							var status = data.status;
							var statusText = data.statusText
							if(status == 401 || status == 400)
							{
								top.location.href = "login.html";
							}
							else if(status == 409)
							{
								window.top.art.dialog({id:"mesg",content:statusText+"!",time:2});
							}
						}

					});
				}
				else
				{
					window.top.art.dialog({id:"tishi",content:DataNotEmpty+"!",time:1});
				}
			}
		}

		function exportWhileSimple(j)
		{
			var items;
			for(var i=0;i<allItemsSimple.length;i++)
			{
				if(allItemsSimple[i].week == j)
				{
					items = allItemsSimple[i].items;
				}
			}
			//excel 表格输出顺序及标题
			var title=[{name:'名称'},{startTime:'开始时间'},{stopTime:'结束时间'}];
			var j_str = Monday;
			if(j == 0)
			{
				j_str = Monday;
			}
			else if(j == 1)
			{
				j_str = Tuesday;
			}
			else if(j == 2)
			{
				j_str = Wednesday;
			}
			else if(j == 3)
			{
				j_str = Thursday;
			}
			else if(j == 4)
			{
				j_str = Friday;
			}
			else if(j == 5)
			{
				j_str = Saturday;
			}
			else if(j == 6)
			{
				j_str = Sunday;
			}
			toExcel(j_str, items, title);
		}
	</script>
</head>

<body>
<div class="pad-10">
	<div class="content-menu ib-a line-x" >
		<a href="javascript:;" onclick="whileBack()" id="back" class="sp_but_cir sp_but_padding btn btn-info">返回</a>
	</div>
	<div class="col-tab">
		<ul class="tabBut cu-li" id="week_li">

		</ul>
	</div>
</div>


<script type="text/javascript">
	function SwapTab(name,cls_show,cls_hide,cnt,cur,dateStr)
	{
		for(i=0;i<=cnt;i++)
		{
			if (i == cur) {
				$('#div_' + name + '_' + i).show();
				$('#tab_' + name + '_' + i).attr('class', cls_show);
			} else {
				$('#div_' + name + '_' + i).hide();
				$('#tab_' + name + '_' + i).attr('class', cls_hide);
			}
		}
		select_tab_val = dateStr;
	}
</script>
</body>
</html>
