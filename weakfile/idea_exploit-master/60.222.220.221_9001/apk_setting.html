<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">

    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/main.css">
    <link href="css/sp.css" rel="stylesheet" type="text/css" />
    <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <link href="css/system.css" rel="stylesheet" type="text/css" />
    <link href="css/table_form.css" rel="stylesheet" type="text/css" />
    <link href="css/dialog.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" src="js/jquery-1.4.1.js"></script>
    <script type="text/javascript" src="js/jquery.corner.js"></script>
    <script type="text/javascript" src="js/admin_common.js"></script>
    <script type="text/javascript" src="js/dialog.js"></script>
    <script type="text/javascript" src="js/cookie.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
    <script type="text/javascript" src="js/encoder.js" ></script>
    <script type="text/javascript" src="js/bean.js"></script>



    <script type="text/javascript">
        $(function(){
            Init_license(authorization);
            var Languages = $.cookie('internationalization');
            if ( Languages == null || Languages == "" )
            {
                Languages = 'zh' ;
            }
            jQuery.i18n.properties({
                name : 'strings', //资源文件名称
                path : '/i18n/', //资源文件路径
                mode : 'map', //用Map的方式使用资源文件中的值
                language : Languages,
                encoding : 'UTF-8', // 必须写 否则中文乱码
                callback : function() {//加载成功后设置显示内容
                    $('#agreementAPK').html($.i18n.prop('AgreementAPK'));
                    $('#td_1').html($.i18n.prop('ProtocolSetting'));
                    $('#td_1_0').html($.i18n.prop('RTMPProtocol'));
                    $('#td_1_1').html($.i18n.prop('RTSPProtocol'));
                    $('#td_1_2').html($.i18n.prop('HLSProtocol'));
                    $('#td_1_3').html($.i18n.prop('TSProtocol'));
                    $('#td_1_4').html($.i18n.prop('HTTPFLVProtocol'));
                    $('#td_1_5').html($.i18n.prop('HTTPTSProtocol'));
                    $('#td_1_6').html($.i18n.prop('Other'));
                    $('#td_2').html($.i18n.prop('Playcorrection'));
                    $('#td_2_0').html($.i18n.prop('Close'));
                    $('#td_2_1').html($.i18n.prop('Open'));
                    $('#td_3').html($.i18n.prop('Correctioncycle'));
                    $('#td_3_0').html($.i18n.prop('unitMin'));
                    $("#dosubmit").val($.i18n.prop('Determine'));

                }
            });
            agreement();
        });

        //获取协议等参数
        function agreement()
        {
            $.ajax({
                type: "GET",
                async: false,
                url: locationHref+"/rest/admin/devices/liveProtocol",//获取设备列表  1,机顶盒
                success: function (data) {
                    var agreementObj = data;
                    var protocol = agreementObj.protocol;
                    $('input[name="agreement"]').each(function(){
                        if($(this).val() == protocol)
                        {
                            $(this).attr("checked","true");
                        }
                    })
                    var bufferEnable = agreementObj.bufferEnable+"";
                    var bufferTime = agreementObj.bufferTime;
                    $("#bufferEnable").val(bufferEnable);
                    $("#bufferTime").val(bufferTime);
                },
                error:function(data)
                {
                    var errorObj = data;
                    var status = data.status;
                    var statusText = data.statusText
                    if(status == 401 || status == 400)
                    {
                        top.location.href = "login.html";
                    }
                }
            })
        }

        //设置基本参数
        function setAgreement()
        {
            var protocol = $('input[name="agreement"]:checked').val();
            var bufferEnable = $("#bufferEnable").val();
            if(bufferEnable == "true")
            {
                bufferEnable = true;
            }
            else
            {
                bufferEnable = false;
            }
            var bufferTime = parseInt($("#bufferTime").val());

            var protocolInfo = new ProtocolInfo(protocol,bufferEnable,bufferTime);
            //alert(stringify(protocolInfo));
            $.ajax({
                type: "PUT",
                async: false,
                url: locationHref+"/rest/admin/devices/liveProtocol",//获取设备列表  1,机顶盒
                data:stringify(protocolInfo),
                success: function (data) {

                },
                error:function(data)
                {
                    var errorObj = data;
                    var status = data.status;
                    var statusText = data.statusText
                    if(status == 401 || status == 400)
                    {
                        top.location.href = "login.html";
                    }
                }
            })
        }
    </script>
</head>
<body id="live_body_id" scroll="yes" style="overflow-y: scroll;">
    <div class="pad-10">
        <div class="col-tab">
            <fieldset>
                <legend id="agreementAPK">终端协议</legend>
                <table width="100%" class="table_form ">
                    <tr >
                        <td align="left" width="10%" id="td_1">
                            协议设置：
                        </td>
                        <td align="left" >
                            <input type="radio" name="agreement" size="56" value="rtmp"><label id="td_1_0">rtmp协议</label>
                            <input type="radio" name="agreement" size="56" value="rtsp"><label id="td_1_1">rtsp协议</label>
                            <input type="radio" name="agreement" size="56" value="hls"><label id="td_1_2">hls协议</label>
                            <input type="radio" name="agreement" size="56" value="ts"><label id="td_1_3">ts协议</label>
                            <input type="radio" name="agreement" size="56" value="httpFlv"><label id="td_1_4">httpFlv协议</label>
                            <input type="radio" name="agreement" size="56" value="httpTs"><label id="td_1_5">httpTs协议</label>
                            <input type="radio" name="agreement" size="56" value="other"><label id="td_1_6">其他</label>
                        </td>
                    </tr>
                    <tr >
                        <td align="left" width="10%" id="td_2">
                            播放矫正：
                        </td>
                        <td align="left" >
                            <select id="bufferEnable">
                                <option id="td_2_0" value="false">关闭</option>
                                <option id="td_2_1" value="true">开启</option>
                            </select>
                        </td>
                    </tr>
                    <tr >
                        <td align="left" width="10%" id="td_3">
                            矫正周期：
                        </td>
                        <td align="left" >
                            <input type="text" id="bufferTime" size="10" value=""><span id="td_3_0" style="color: red;display: inline;">单位:分钟(min)</span>
                        </td>
                    </tr>
                    <tr>
                        <td align="left" >
                            <input  type="button" value=" 确定 " id="dosubmit" onclick="setAgreement()" class="ext_btn ext_btn_submit" />
                        </td>
                        <td align="left" >
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

</body>
</html>