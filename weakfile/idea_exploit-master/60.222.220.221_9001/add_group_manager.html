<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title></title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">

	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/main.css">
	<link href="css/sp.css" rel="stylesheet" type="text/css" />
	<link href="css/reset.css" rel="stylesheet" type="text/css" />
	<link href="css/system.css" rel="stylesheet" type="text/css" />
	<link href="css/table_form.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" href="css/dialog.css">
	<script type="text/javascript" src="js/dialog.js"></script>
	<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
	<script type="text/javascript" src="js/cookie.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
	<script type="text/javascript" src="js/add_edit_live.js"></script>
	<script type="text/javascript" src="js/time2.js"></script>
	<script type="text/javascript" src="js/bean.js"></script>
	<script type="text/javascript">
		var InformationIsNotCorrect ;

		$(function(){
			Init_license(authorization);
			var Languages = $.cookie('internationalization');

			if ( Languages == null || Languages == "" )
			{
				Languages = 'zh' ;
			}
			jQuery.i18n.properties({
				name : 'strings', //资源文件名称
				path : '/i18n/', //资源文件路径
				mode : 'map', //用Map的方式使用资源文件中的值
				language : Languages,
				encoding : 'UTF-8', // 必须写 否则中文乱码
				callback : function() {//加载成功后设置显示内容
					$('#information').html($.i18n.prop('EssentialInformation'));
					$('#td_1').html($.i18n.prop('Name'));
					$('#td_2').html($.i18n.prop('AllowUser'));
					$('#td_3').html($.i18n.prop('LiveChannel'));
					$('#td_4').html($.i18n.prop('DeviceType'));
					$('#add').html($.i18n.prop('Add'));
					$('#remove').html($.i18n.prop('Remove'));
					$('#apk').html($.i18n.prop('apk'));
					$('#encoder').html($.i18n.prop('encoder'));
					$('#decoder').html($.i18n.prop('decoder'));
					$('#gateway').html($.i18n.prop('gateway'));
					$('#dosubmit').val($.i18n.prop('Determine'));
					$('#td_111').html($.i18n.prop('Word'));
					$('#td_222').html($.i18n.prop('Time'));

					InformationIsNotCorrect = $.i18n.prop('InformationIsNotCorrect')
				}
			});
		});

		(function($){
			$.getUrlParam = function(name)
			{
				var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if (r!=null) return unescape(r[2]); return null;
			}
		})(jQuery);
		var liveType = $.getUrlParam("liveType");//区别权限的
		var deviceType = $.getUrlParam("deviceType");//添加分组类型,如果有值1,那就是机顶盒,diffDevice需要隐藏,其他类型值不存在

		$(function(){
			if(deviceType == 1)
			{
				$("#apk_diff").show();
			}
			else
			{
				$("#apk_diff").hide();
			}
			$.ajax({
				type:"GET",
				url:locationHref+"/rest/admin/lives",//获取直播频道
				async: false,
				success: function (data)
				{
					var obj = data;
					for (var i = 0; i < obj.length; i++)
					{
						var id = obj[i].id;
						var alias = obj[i].alias;
						var dom ='';
						dom += '<span style="min-width: 60px;float: left;"><input type="checkbox" id="channelId_'+id+'" value="'+id+'" checked name="channelId"><label for="channelId_'+id+'">&nbsp;&nbsp;'+alias+'</label></span>';
						$("#liveChannel").append(dom);
					}
				},
				error:function(data)
				{
					var errorObj = data;
					var status = data.status;
					var statusText = data.statusText
					if(status == 401 || status == 400)
					{
						top.location.href = "login.html";
					}
				}
			})

		})

		function addGroup() {
			var name = $("#name").val();
			var liveId = "";
			$('input[name="channelId"]:checked').each(function(){
				liveId += $(this).val()+",";
			});

			var word = $("#word").val();
			var time = $("#time").val();
			var titleInfo = new SubTiltle(word,time);
			var groupInfo = new GroupInfo(name,liveId,titleInfo);

			$.ajax({
				type: "POST",
				url: locationHref+"/rest/admin/termGroup/"+deviceType+"/addGroup",//添加组
				async: false,
				data:stringify(groupInfo),
				success: function (data)
				{
					window.top.load_admin();
				},
				error:function(data)
				{
					var errorObj = data;
					var status = data.status;
					var statusText = data.statusText
					if(status == 401 || status == 400)
					{
						top.location.href = "login.html";
					}
				}
			})
		}

		//设备类型切换
		function devChange(obj)
		{
			var devType = parseInt(obj.value);
			if(devType == 1)
			{
				$("#liveChannelId").show();
				$("#subTitleWord").show();
				$("#subTitleTime").show();
			}
			else
			{
				$("#liveChannelId").hide();
				$("#subTitleWord").hide();
				$("#subTitleTime").hide();
			}
		}
	</script>
</head>

<body>

<div class="pad-10">
<div class="common-form">
<form id="myform" method="post" action="" name="myform">
	<input type="hidden" name="dialog" value="add">
	<fieldset>
		<legend id="information">基本信息</legend>
		<table width="100%" class="table_form">
			<tbody>
				<tr>
					<td width="80" id="td_1">名称</td>
					<td>
						<input type="text" id="name" class="input-text" name="name" value="">
					</td>
				</tr>
				<tbody id="diffDevice" style="display: none;">
					<tr>
						<td width="80" id="td_4">设备类型</td>
						<td>
							<select id="devType" onchange="devChange(this)">
								<!--<option id="apk" value="1">机顶盒</option>-->
								<option id="encoder" value="2">编码器</option>
								<option id="gateway" value="3">网关</option>
								<!--<option id="decoder" value="4">解码器</option>-->
							</select>
						</td>
					</tr>
				</tbody>
				<tbody id="apk_diff" style="display: none;">
					<tr id="liveChannelId">
						<td width="80" id="td_3">频道</td>
						<td id="liveChannel">

						</td>
					</tr>
					<!--<tr id="subTitleWord">
						<td width="80" id="td_111">内容</td>
						<td>
							<textarea id="word" name="word" value=""></textarea>
						</td>
					</tr>
					<tr id="subTitleTime">
						<td width="80" id="td_222">时间</td>
						<td>
							<input name="time" id="time" value="" onclick="_SetTime2(this)" readonly="" size="13" class="input-text" type="text">
						</td>
					</tr>-->
				<textarea id="word" name="word" style="display: none;" value=""></textarea>
				<input name="time" id="time" value="" onclick="_SetTime2(this)" readonly="" size="13" class="input-text" type="hidden">
				</tbody>
				<input type="hidden" name="devType_hide" id="devType_hide" value="">
				<!--<tr>
					<td width="80" id="td_2">允许用户访问</td>
					<td>
						<div id="urls">
							<div>
								<a herf="javascript:;" id="add" class="sp_but_cir sp_but_padding btn-primary">增加</a>
								<a herf="javascript:;" id="remove" class="sp_but_cir sp_but_padding btn-primary">移除</a>
							</div>
							<div id="main_body" style="margin-top: 10px;"></div>
						</div>
					</td>
				</tr>-->
			</tbody>
		</table>
	</fieldset>
  
    <input type="submit" class="dialog" value="确定" id="dosubmit" name="dosubmit">
	<!--<a href="#" class=" sp_but_cir sp_but_padding btn btn-info" >取消</a>-->
	</form>
</div>
</div>

</body>
</html>
