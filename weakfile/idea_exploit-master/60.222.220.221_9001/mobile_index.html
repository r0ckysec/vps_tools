<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
	<title>视频直播</title>
	<link href="mobile/css/bootstrap.min.css" rel="stylesheet">
	<link href="mobile/css/ionicons.css" rel="stylesheet">
	<link href="mobile/css/jquery.bxslider.css" rel="stylesheet">
	<link href="mobile/css/style.css" rel="stylesheet">
	<script type="text/javascript" src="js/cookie.js"></script>
	<!--[if lt IE 9]>
	<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
	<![endif]-->
	<style type="text/css">
	.nochecked{
			width: 100%;
			height: 80px;
			float: left;
		}
	.checked{
		width: 100%;
		height: 80px;
		float: left;
		background-color: #06a7e1;
	}

	</style>

</head>
<body>
<input type="hidden" id="firstAppName" value="" >
<input type="hidden" id="firstLiveName" value="" >
 <div id="container" style="overflow:hidden;">
	 <div class="title">
		 <img src="images/001.jpg" />&nbsp;&nbsp;&nbsp;&nbsp;欢迎使用直播系统
		 <div style="float:right; margin-right:30px; display:inline;"><a href="/login.html" target="_blank" style="color:#309">管理员入口</a></div>
	 </div>
 <div style="margin-top: 15px;"></div>
    <div id="mainbody">
      <div class="container">
        <div class="row" style="margin-left: -30px;margin-right: -30px;">
          <div class="video-container">
              <div class="player">
              <div style="margin-top:0px;clear:both;color:#555;font-size:28px;text-align:center;font-family: '微软雅黑',Arial, Helvetica, sans-serif;font-weight: bold;">
				
			  </div>
              <!-- *************************  player start *********************************** --> 
        <div id="swfContent" style="height:200px;width:100%"></div>
        <script src="mobile/js/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="ckplayer/js/offlights.js"></script>
		<script type="text/javascript" src="ckplayer/ckplayer.js" charset="utf-8"></script>
		<script type="text/javascript" src="ckplayer/js/player.js" charset="utf-8"></script>
	    <script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
		  <script type="text/javascript">
			  (function($){
				  $.getUrlParam = function(name)
				  {
					  var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
					  var r = window.location.search.substr(1).match(reg);
					  if (r!=null) return unescape(r[2]); return null;
				  }
			  })(jQuery);

			  var live_all = $.getUrlParam("id");
			  var appName_all = $.getUrlParam("appName");
			  var name_all = $.getUrlParam("name");
			  var host = window.location.hostname;
			  var port = window.location.port;
			  $(function(){
				  init_live_list();
			  });

			  function LiveInfo(id,appName,name,streamType)
			  {
				  this.id = id;
				  this.appName = appName;
				  this.name = name;
				  this.streamType = streamType;
			  }
			  var liveInfo;
			  var liveArray = new Array();
			  function init_live_list(channel_type)
			  {
				  if(channel_type == undefined)
				  {
					  channel_type = 0;
				  }
				  $.ajax({
					  type:"GET",
					  url:locationHref+"/rest/client/lives",//获取直播频道
					  //处理CGI返回的JSON数据
					  success: function(data)
					  {
						  //解析JSON
						  var obj = data;
						  if(obj == null )
						  {
							  return ;
						  }
						  for(var i=0;i<obj.length;i++)
						  {
							  //获取JSON对象的每个属性的值
							  var id = obj[i]['id'];
							  var alias = obj[i]['alias'];
							  var appName = obj[i]['appName'];
							  var name = obj[i]['name'];
							  var streamType = obj[i]['right']+"";
							  var liveStatus = obj[i].liveStatus;
							  var hls = obj[i].hlsStatus;
							  var rtmpPort = obj[i].rtmpPort;
							  //创建DOM
							  liveInfo = new LiveInfo(id,appName,name,streamType);
							  liveArray[i] = liveInfo;
							  $("#firstAppName").val(obj[0]['appName']);
							  $("#firstLiveName").val(obj[0]['name']);
						  }
						  write_live(liveArray,rtmpPort);
					  },
					  error:function()
					  {

					  }
				  });//ajax end
			  }

			  var url;
			  var hlsUrl;
			  var appName1;
			  var name1;
			  var url1;
			  var hlsUrl1;
			  var showName;
			  function write_live(rArray,rtmp_port)
			  {
                  var obj = rArray;
                  for(var j=0;j<obj.length;j++)
                  {
                      var liveId =obj[j].id;
                      var appName = obj[j].appName;
                      var name = obj[j].name;
                      if(appName_all != '' && name_all != '' && live_all != '')
                      {
                          if(appName_all == appName && liveId == live_all && name_all == name )
                          {
                              url = "rtmp://"+host+":"+rtmp_port+"/"+obj[j].appName+"/"+obj[j].name;
                              hlsUrl = "http://"+host+":"+port+"/"+"hls"+"/"+obj[j].appName+"/"+obj[j].name+"/stream.m3u8";
                          }
                      }
                      else
                      {
                          url = "rtmp://"+host+":"+rtmp_port+"/"+obj[0].appName+"/"+obj[0].name;
                          hlsUrl = "http://"+host+":"+port+"/"+"hls"+"/"+obj[0].appName+"/"+obj[0].name+"/stream.m3u8";
                      }
                      var dom = "<li>";
                      dom += "<a target='_self' href='mobile_index.html?id="+liveId+"&appName="+appName+"&name="+name+"'>"+name+"</a></li>";
                      $("#showLi").append(dom);
                  }
                  ckPlay(url,hlsUrl);
			  }
		  </script>
		<script type="text/javascript">
			//如果你不需要某项设置，可以直接删除，注意var flashvars的最后一个值后面不能有逗号
			function loadedHandler(){
				if(CKobject.getObjectById('ckplayer_swfContent').getType()){//说明使用html5播放器
					//alert('播放器已加载，调用的是HTML5播放模块');
				}
				else{
					//alert('播放器已加载，调用的是Flash播放模块');
				}
			}
			function ckPlay(url,hlsUrl)
			{
				var playUrl = url;
				var hlsUrl = hlsUrl;//hls address
				var flashvars={
					f:playUrl,//视频地址  可以支持HTTP的方式播放MP4文件
					a:'',//调用时的参数，只有当s>0的时候有效
					s:'0',//调用方式，0=普通方法（f=视频地址），1=网址形式,2=xml形式，3=swf形式(s>0时f=网址，配合a来完成对地址的组装)
					c:'0',//是否读取文本配置,0不是，1是
					x:'',//调用配置文件路径，只有在c=1时使用。默认为空调用的是ckplayer.xml
					i:'',//初始图片地址
					d:'',//暂停时播放的广告，swf/图片,多个用竖线隔开，图片要加链接地址，没有的时候留空就行
					u:'',//暂停时如果是图片的话，加个链接地址
					l:'',//前置广告，swf/图片/视频，多个用竖线隔开，图片和视频要加链接地址    *****若有前置广告则不会去自动播放
					r:'',//前置广告的链接地址，多个用竖线隔开，没有的留空
					t:'',//视频开始前播放swf/图片时的时间，多个用竖线隔开
					y:'',//这里是使用网址形式调用广告地址时使用，前提是要设置l的值为空
					z:'',//缓冲广告，只能放一个，swf格式
					e:'1',//视频结束后的动作，0是调用js函数，1是循环播放，2是暂停播放并且不调用广告，3是调用视频推荐列表的插件，4是清除视频流并调用js功能和1差不多，5是暂停播放并且调用暂停广告
					v:'80',//默认音量，0-100之间
					p:'1',//视频默认0是暂停，1是播放，2是不加载视频
					h:'3',//播放http视频流时采用何种拖动方法，=0不使用任意拖动，=1是使用按关键帧，=2是按时间点，=3是自动判断按什么(如果视频格式是.mp4就按关键帧，.flv就按关键时间)，=4也是自动判断(只要包含字符mp4就按mp4来，只要包含字符flv就按flv来)
					q:'',//视频流拖动时参考函数，默认是start
					m:'',//让该参数为一个链接地址时，单击播放器将跳转到该地址
					o:'',//当p=2时，可以设置视频的时间，单位，秒
					w:'',//当p=2时，可以设置视频的总字节数
					g:'',//视频直接g秒开始播放
					j:'',//跳过片尾功能，j>0则从播放多少时间后跳到结束，<0则总总时间-该值的绝对值时跳到结束
					k:'',//提示点时间，如 30|60鼠标经过进度栏30秒，60秒会提示n指定的相应的文字
					n:'',//提示点文字，跟k配合使用，如 提示点1|提示点2
					wh:'16:9',//宽高比，可以自己定义视频的宽高或宽高比如：wh:'4:3',或wh:'1080:720'
					lv:'1',//是否是直播流，=1则锁定进度栏
					loaded:'loadedHandler',//当播放器加载完成后发送该js函数loaded
					//调用播放器的所有参数列表结束
					//以下为自定义的播放器参数用来在插件里引用的
					my_url:encodeURIComponent(window.location.href)//本页面地址
					//调用自定义播放器参数结束
				};

				var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always'};//这里定义播放器的其它参数如背景色（跟flashvars中的b不同），是否支持全屏，是否支持交互
				var video=[hlsUrl];

				CKobject.embed('ckplayer/ckplayer.swf','swfContent','ckplayer_swfContent','100%','200',false,flashvars,video,params);
			}
		  </script>
    <!-- ***************************  player end *********************************** --> 
          <div class="video-detail">
            <div class="tab">
              <div class="tab-title">
                <div class="row">
            <div class="nav col-xs-12" style="width: 100%;">
              <ul id="showLi" style="height: auto;">
						  <!--	<s:iterator value="liveGroupBeans" var="u" status="st" id="u">
								<s:iterator value="#u.customLiveChannelInfos" id="uu" status="st">
								 <s:if test="#u.moduleType == 1">
									<li>
										<a <s:if test="#uu.id == customLiveChannelInfo.id">class="cur"</s:if> href="/ui/content/live.action?mobile=get&cateid=${u.id }&id=${uu.id}">
											${uu.alias }
										</a>
									</li>
								 </s:if>
								</s:iterator>
							</s:iterator>-->
              </ul>
            </div>
          </div>
              </div>
          </div>
        </div><!-- End Row -->
      </div><!-- End Container -->
    </div><!-- End Mainbody -->
  	<!-- End Footer -->
    <script src="/mobile/js/jquery.bxslider.min.js"></script>
    <script src="/mobile/js/bootstrap.min.js"></script>
    <script src="/mobile/js/jquery.idTabs.min.js"></script>    
    <script src="/mobile/js/common.js"></script>
    <script src="/mobile/js/jquery.json-2.4.js"></script>
    <script type="text/javascript">
     $(function(){
	$("#nav_detail").hide();
     })
 </script>
  </div><!-- Container -->
		  </div>
		</div>
	
	 </div>

</body>
</html>