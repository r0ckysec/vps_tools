<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="js/jquery-1.4.1.js"></script>
    <script type="text/javascript" src="js/cookie.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
    <title>文件拖拽</title>
    <script type="text/javascript">
        function DirInfo(path)
        {
            this.path = path;
        }

        var saveSelectPath = $("#selectPath").val();
        $(function(){
            var dirInfo = new DirInfo();
            $.ajax({
                type: "POST",
                url: locationHref+"/rest/admin/system/getSubDirList",//添加虚拟目录
                async: false,
                data: stringify(dirInfo),
                success:function(data)
                {
                    var dom = "";
                    for(var i=0;i<data.length;i++)
                    {
                        var path = data[i].path;
                        if(path.indexOf(":") != -1)//包含
                        {
                            path = path.substr(0,path.indexOf(":"));
                            dom += '<div id="path_div_'+i+'" style="float: left;width:300px;height:20px;border:1px solid #999;display: inline;" ondblclick="getSubdirInfo(\''+path+'\',\''+i+'\',1)">'+path+'</div>';
                        }
                        else
                        {
                            dom += '<div id="path_div_'+i+'" style="float: left;width:300px;height:20px;border:1px solid #999;display: inline;" ondblclick="getSubdirInfo(\''+path+'\',\''+i+'\',3)">'+path+'</div>';
                        }

                    }
                    $("#main").append(dom);

                },
                error:function(data)
                {
                    var errorObj = data;
                    var status = data.status;
                    var statusText = data.statusText
                    if(status == 401 || status == 400)
                    {
                        top.location.href = "login.html";
                    }
                }
            });
        })


        function getSubdirInfo(path,index,type)
        {
            $("#main").empty();
            if(path == 1)
            {
                var typePath = $("#selectPath").val();
                if(typePath == 0)
                {
                    saveSelectPath = "";
                    $("#selectPath").val(0);
                }
                else
                {
                    saveSelectPath = typePath;
                    $("#selectPath").val(typePath);
                }
            }
            else
            {
                if(type == 1)
                {
                    saveSelectPath = path +":/";
                    $("#selectPath").append('<option value="'+saveSelectPath+'">'+saveSelectPath+'</option>');
                    $("#selectPath").val(saveSelectPath);
                }
                else
                {
                    if(type == 3 || type == 4)
                    {
                        if (saveSelectPath == "" || saveSelectPath == undefined)
                        {
                            saveSelectPath = "/"+path;
                        }
                        else
                        {
                            saveSelectPath = saveSelectPath+"/"+ path;
                        }
                    }
                    else
                    {
                        if (saveSelectPath == "" || saveSelectPath == "undefined")
                        {
                            saveSelectPath = path +":/";
                        }
                        else
                        {
                            saveSelectPath = saveSelectPath+"/"+ path;
                        }
                    }
                    saveSelectPath = saveSelectPath.replace("//","/");
                    $("#selectPath").append('<option value="'+saveSelectPath+'">'+saveSelectPath+'</option>');
                    $("#selectPath").val(saveSelectPath);
                }
            }
            var dirInfo = new DirInfo(saveSelectPath);
            $.ajax({
                type: "POST",
                url: locationHref+"/rest/admin/system/getSubDirList",//添加虚拟目录
                async: false,
                data: stringify(dirInfo),
                success:function(data)
                {
                    var dom = "";
                    for(var i=0;i<data.length;i++)
                    {
                        var subPath = data[i].path;
                        if(subPath.indexOf(":") != -1)
                        {
                            subPath = subPath.substr(0,subPath.indexOf(":"));
                            dom += '<div id="path_sub_'+i+'" style="float: left;width:250px;height:20px;border:1px solid #999;display: inline;" ondblclick="getSubdirInfo(\''+subPath+'\',\''+i+'\',2)">'+subPath+'</div>';
                        }
                        else
                        {
                            dom += '<div id="path_sub_'+i+'" style="float: left;width:250px;height:20px;border:1px solid #999;display: inline;" ondblclick="getSubdirInfo(\''+subPath+'\',\''+i+'\',4)">'+subPath+'</div>';
                        }
                    }
                    $("#main").append(dom);

                },
                error:function(data)
                {
                    var errorObj = data;
                    var status = data.status;
                    var statusText = data.statusText
                    if(status == 401 || status == 400)
                    {
                        top.location.href = "login.html";
                    }
                }
            });
        }


        function setSubDirInfo()
        {
            return saveSelectPath;
        }


    </script>
</head>
<body>
<select type="text" id="selectPath" name="selectPath" onchange="getSubdirInfo(1)">
    <option value="0">默认</option>
</select>
<div id="main">

</div>
</body>
</html>