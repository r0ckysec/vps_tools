<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/main.css">
    <link href="css/sp.css" rel="stylesheet" type="text/css" />
    <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <link href="css/system.css" rel="stylesheet" type="text/css" />
    <link href="css/table_form.css" rel="stylesheet" type="text/css" />
    <link href="css/zh-cn-system.css" rel="stylesheet" type="text/css" />
    <link href="css/dialog.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" src="js/jquery-1.4.1.js"></script>
    <script type="text/javascript" src="js/jquery.corner.js"></script>
    <script type="text/javascript" src="js/admin_common.js"></script>
    <script type="text/javascript" src="js/dialog.js"></script>
    <script type="text/javascript" src="js/add_edit_live.js"></script>
    <script type="text/javascript" src="js/cookie.js"></script>
    <script type="text/javascript" src="js/jbase64.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
    <script type="text/javascript" src="js/bean.js"></script>
    <script type="text/javascript" src="js/changStatus.js"></script>
    <script type="text/javascript">
        (function($){
            $.ajaxSetup({ cache: false });
            $.getUrlParam = function(name)
            {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r!=null) return unescape(r[2]); return null;
            }
        })(jQuery);

        var liveId = $.getUrlParam("id");
        var PleaseSelectTranscodingScheme;
        var addTransfer;
        $(function(){
            Init_license(authorization);
            var Languages = $.cookie('internationalization');
            if ( Languages == null || Languages == "" )
            {
                Languages = 'zh' ;
            }
            jQuery.i18n.properties({
                name : 'strings', //资源文件名称
                path : '/i18n/', //资源文件路径
                mode : 'map', //用Map的方式使用资源文件中的值
                language : Languages,
                encoding : 'UTF-8', // 必须写 否则中文乱码
                callback : function() {//加载成功后设置显示内容
                    $('#tab_setting_1').html($.i18n.prop('BasicConfiguration'));
                    $('#tab_setting_2').html($.i18n.prop('AdvancedConfiguration'));
                    $('#tab_setting_3').html($.i18n.prop('VideoConfiguration'));

                    $('#td_1').html($.i18n.prop('ApplyName')+":");
                    $('#td_2').html($.i18n.prop('LiveChannelName')+":");
                    $('#td_3').html($.i18n.prop('Alias'));
                    $('#td_4').html($.i18n.prop('LiveChannelGroup'));
                    $('#td_5').html($.i18n.prop('VideoStoragePath')+":("+$.i18n.prop('FormatSuchAs')+":e:/data)");
                    $('#td_5_1').html($.i18n.prop('FormattingTips'));
                    $('#td_6').html($.i18n.prop('SubStreamCreationMethod'));
                    $('#td_6_1').html($.i18n.prop('PullMode'));
                    $('#td_6_2').html($.i18n.prop('PushMode'));
                    //$('#td_7').html($.i18n.prop('ReturnDays'));
                    $('#td_8').html($.i18n.prop('StreamReleaseMode'));
                    $('#td_8_1').html($.i18n.prop('StreamReleaseMode_1'));
                    $('#td_8_2').html($.i18n.prop('StreamReleaseMode_2'));
                    $('#td_8_3').html($.i18n.prop('StreamReleaseMode_3'));
                    $('#td_8_4').html($.i18n.prop('StreamReleaseMode_4'));
                    $('#td_9').html($.i18n.prop('FlowMode'));
                    $('#td_9_1').html($.i18n.prop('PushMode'));
                    $('#td_9_2').html($.i18n.prop('PullMode'));
                    $('#td_10').html($.i18n.prop('StartPull'));
                    $('#td_10_1').html($.i18n.prop('StartWhenClientAccess'));
                    $('#td_10_2').html($.i18n.prop('StartImmediately'));
                    $('#td_11').html($.i18n.prop('PullFlowAutomaticallyClosed'));
                    $('#td_11_1').html($.i18n.prop('Open'));
                    $('#td_11_2').html($.i18n.prop('Close'));
                    $('#td_12').html($.i18n.prop('ConnectionStreamAddress'));
                    $('#url').attr("title",$.i18n.prop('FlowAddressCanBe')+"&#10; rtmp://192.168.1.1:1935/live/live1&#10;rtsp://192.168.1.23&#10;udp://@234.5.6.7:9000&#10;mms://192.168.1.12/live");
                    $('#td_13').html($.i18n.prop('WhetherNeedVideoTranscoding')+":");
                    $('#td_13_1').html($.i18n.prop('No'));
                    $('#td_13_2').html($.i18n.prop('Yes'));
                    $('#td_14').html($.i18n.prop('ResolvingPower'));
                    $('#td_15').html($.i18n.prop('TheFrameRate'));
                    $('#td_16').html($.i18n.prop('VideoBitRate'));
                    $('#td_17').html($.i18n.prop('WhetherTheAudioNeedsTranscoding')+":");
                    $('#td_17_1').html($.i18n.prop('No'));
                    $('#td_17_2').html($.i18n.prop('Yes'));
                    $('#td_18').html($.i18n.prop('SamplingRate'));
                    $('#td_19').html($.i18n.prop('AudioBitRate'));
                    $('#td_20').html($.i18n.prop('AudioChannels'));
                    $('#td_21').html($.i18n.prop('Enable')+" HLS");
                    $('#td_21_1').html($.i18n.prop('Disable'));
                    $('#td_21_2').html($.i18n.prop('Enable'));
                    $('#td_22').html($.i18n.prop('Enable')+" TS");
                    $('#td_22_1').html($.i18n.prop('Disable'));
                    $('#td_22_2').html($.i18n.prop('Enable'));
                    $('#td_23').html("TS " + $.i18n.prop('Address'));
                    $('#td_23_1').html($.i18n.prop('FormatSuchAs')+": 234.2.5.7:9000");
                    $('#td_24').html($.i18n.prop('RecordFileProcessing')+":");
                    $('#td_24_1').html($.i18n.prop('RecordFileProcessing_1'));
                    $('#td_24_2').html($.i18n.prop('RecordFileProcessing_2'));
                    $('#td_24_3').html($.i18n.prop('RecordFileProcessing_3'));
                    $('#td_25').html($.i18n.prop('Videotape')+":");
                    $('#td_25_1').html($.i18n.prop('AllowVideo'));
                    $('#td_25_2').html($.i18n.prop('DoNotAllowVideo'));
                    $('#td_26').html($.i18n.prop('VideoMode'));
                    $('#td_26_1').html($.i18n.prop('Manual'));
                    $('#td_26_2').html($.i18n.prop('Timing'));
                    $('#td_26_3').html($.i18n.prop('StreamingVideo'));
                    $('#td_27').html($.i18n.prop('VideoFileMode'));
                    $('#td_27_1').html($.i18n.prop('VideoFileMode_1'));
                    $('#td_27_2').html($.i18n.prop('VideoFileMode_2'));
                    $('#td_28').html($.i18n.prop('HowLongInAdditionalDevascularization'));
                    $("#td_28_1").html($.i18n.prop('Company')+"("+$.i18n.prop('Second')+")");
                    $('#td_29').html($.i18n.prop('HowLongIsTheVideoFile'));
                    $("#td_29_1").html($.i18n.prop('Company')+"("+$.i18n.prop('Minute')+")");
                    $('#td_30').html($.i18n.prop('VideoFormat'));
                    $('#td_31').html($.i18n.prop('HowMuchIsTheVideoFile'));
                    $("#td_31_1").html($.i18n.prop('Company')+"("+$.i18n.prop('M')+")");
                    $('#td_32').html($.i18n.prop('SegmentMode'));
                    $("#td_32_1").html($.i18n.prop('Time'));
                    $("#td_32_2").html($.i18n.prop('Much'));
                    $("#td_33").html($.i18n.prop('DelaySeconds'));
                    $("#td_40").html($.i18n.prop('PullStream'));
                    $("#td_40_2").html($.i18n.prop('StartNowPull'));
                    $("#td_40_1").html($.i18n.prop('ClientAccessStartsPull'));
                    $("#td_50").html($.i18n.prop('PushStream'));
                    $("#td_50_2").html($.i18n.prop('StartNowPush'));
                    $("#td_50_1").html($.i18n.prop('ClientAccessStartsPush'));
                    $("#td_url").html($.i18n.prop('Spareflowlist'));
                    $("#transcodingScheme").html($.i18n.prop('TranscodingScheme'));

                    addTransfer = $.i18n.prop('AddTransfer') ;
                    PleaseSelectTranscodingScheme = $.i18n.prop('PleaseSelectTranscodingScheme') ;
                }
            });
            createTfServerSelect("tfServerOuter");
            init_whole(liveId);
        });

        var objLive ="";
        function init_whole(liveId)
        {
            $.ajax({
                type:"GET",
                async: false,
                url:locationHref+"/rest/admin/lives/"+liveId,//获取一个直播频道
                success: function (data) {
                    objLive  = data;
                    var obj = data;
                    $("#appName").val(obj.appName);
                    $("#liveName").val(obj.name);
                    $("#dataPath").val(obj.dataPath);
                    // $("#right").val(parseInt(obj.right));
                    $("#alias").val(obj.alias);
                    $("#outputMode").val(parseInt(obj.outputMode));
                    $("#keepPlaybackDays").val(parseInt(obj.keepPlaybackDays));
                    $("#liveProperty").val(parseInt(obj.liveProperty));

                    var push = obj.push+"";//流方式
                    var lazyPull = obj.lazyPull+"";//拉流客户端或者立即
                    var lazyPush = obj.lazyPush+"";//推流客户端或者立即
                    var playDeleayTime = obj.playDeleay;//缓冲时间
                    var autoClosePull = obj.autoClosePull+"";//自动关闭
                    $("#isPush").val(push);
                    $("#lazyPull").val(lazyPull);
                    $("#lazyPush").val(lazyPush);
                    $("#playDeleay").val(playDeleayTime);
                    $("#autoClosePull").val(autoClosePull);
                    if(obj.pullStream != "")
                    {
                        var pullVal = obj.pullStream.url;
                        $("#url").val(pullVal);
                        $("#engineId").val(obj.pullStream.engineId);
                    }
                    pull_select(push);
                    if(push == "true")
                    {
                        select_take(lazyPush);
                        $("input[type='radio'][value='false']").attr("checked",true);
                        $("#transferPlan").hide();
                    }
                    else
                    {
                        select_take_pull(lazyPull);
                        if(obj.pullStream.transfId == "")
                        {
                            $("input[type='radio'][value='false']").attr("checked",true);
                            $("#transferPlan").hide();
                        }
                        else
                        {
                            $("input[type='radio'][value='true']").attr("checked",true);
                            $("#transferPlan").show();
                        }
                    }
                    $("#enableHLS").val(obj.enableHLS+"");
                    $("#enableTS").val(obj.enableTS+"");
                    $("#tsAddress").val(obj.tsAddress);
                    $("#delaySeconds").val(parseInt(obj.delaySeconds));
                    $("#flvKeyframe").val(parseInt(obj.flvKeyframe));
                    $("#recordEnabled").val(obj.recordEnabled+"");
                    $("#recordType").val(parseInt(obj.recordType));
                    if(parseInt(obj.intervalTime) == 0)
                    {
                        $("#splitRecord").val("much");
                        $("#time_type").hide();
                        $("#much_type").show();
                        $("#splitFileSize").val(parseInt(obj.splitFileSize));
                    }
                    if(parseInt(obj.splitFileSize) == 0)
                    {
                        $("#splitRecord").val("time");
                        $("#time_type").show();
                        $("#much_type").hide();
                        $("#intervalTime").val(parseInt(obj.intervalTime));
                    }
                    $("#timeToApend").val(obj.timeToApend+"");
                    $("#format").val(obj.format);
                    $("#tsStatus").val(obj.tsStatus+"");
                    $("#hlsStatus").val(obj.hlsStatus+"");
                    if(obj.pullStream != "")
                    {
                        $("#url").val(obj.pullStream.url);
                        $("#tf_select").val(obj.pullStream.transfId);
                        var urls = obj.pullStream.urls;
                        if(urls != "")
                        {
                            $("#main_body").empty();
                            for(var y=0;y<urls.length;y++)
                            {
                                var url = urls[y].url;
                                var dom = '<div class="item">';
                                dom += '<div class="mystyle" style="display: inline;">';
                                dom += '<input title="流地址可以是: ';
                                dom += 'rtmp://192.168.1.1:1935/live/live1';
                                dom += 'rtsp://192.168.1.23';
                                dom += 'udp://@234.5.6.7:9000';
                                dom += 'mms://192.168.1.12/live" class="input-text" type="text" id="urls" name="urls" size="56" value="'+url+'">';
                                dom += '</div>';
                                dom += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_add(this)" title="添加" id="add">+</a>';
                                dom += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_remove(this)" title="移除" id="Remove">-</a>';
                                dom += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_up(this)" title="上移" id="Upward">U</a>';
                                dom += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_down(this)" title="下移" id="down">D</a>';
                                dom += '<a href="javascript:;" style="display: inline;" class="button" onclick="checkStream(this)" title="流连接测试" id="check">流连接测试</a>';
                                dom += '</div>';
                                $("#main_body").append(dom);
                            }
                        }
                        else
                        {
                            $("#main_body").empty();
                            var dom1 = '<div class="item">';
                            dom1 += '<div class="mystyle" style="display: inline;">';
                            dom1 += '<input title="流地址可以是: ';
                            dom1 += 'rtmp://192.168.1.1:1935/live/live1';
                            dom1 += 'rtsp://192.168.1.23';
                            dom1 += 'udp://@234.5.6.7:9000';
                            dom1 += 'mms://192.168.1.12/live" class="input-text" type="text" id="urls" name="urls" size="56" value="">';
                            dom1 += '</div>';
                            dom1 += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_add(this)" title="添加" id="add">+</a>';
                            dom1 += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_remove(this)" title="移除" id="Remove">-</a>';
                            dom1 += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_up(this)" title="上移" id="Upward">U</a>';
                            dom1 += '<a href="javascript:;" style="display: inline;" class="button" onclick="m_down(this)" title="下移" id="down">D</a>';
                            dom1 += '<a href="javascript:;" style="display: inline;" class="button" onclick="checkStream(this)" title="流连接测试" id="check">流连接测试</a>';
                            dom1 += '</div>';
                            $("#main_body").append(dom1);
                        }
                    }
                },
                error:function(data)
                {
                    var errorObj = data;
                    var status = data.status;
                    var statusText = data.statusText
                    if(status == 401 || status == 400)
                    {
                        top.location.href = "login.html";
                    }
                }
            })
        }

        function chooseUrls(url)
        {
            $("#url").val(url);
        }

        function editLive()
        {
            var tf_se = $("#tf_select").val();
            if(tf_se == "-1" || tf_se == undefined)
            {
                tf_se = "";
            }
            var live = objLive;
            var id = parseInt($.getUrlParam("id"));
            var appName = $("#appName").val();
            var name = $("#liveName").val();
            var dataPath = $("#dataPath").val();
            var right = 1;
            var alias = $("#alias").val();
            var outputMode = parseInt($("#outputMode").val());
            var keepPlaybackDays = 0;
            var liveProperty = parseInt($("#liveProperty").val());
            var pullStream = live.pullStream;
            var lazyPush;
            var lazyPull;
            var autoClosePull;
            var push = $("#isPush").val();
            if(push == "true")
            {
                push  = true;
                pullStream = null;
                lazyPush = $("#lazyPush").val();
                if(lazyPush == "true")
                {
                    lazyPush = true;
                    autoClosePull = $("#autoClosePull").val();
                    if(autoClosePull == "true")
                    {
                        autoClosePull = true;
                    }
                    else
                    {
                        autoClosePull = false;
                    }
                }
                else
                {
                    lazyPush = false;
                    autoClosePull = false;
                }
            }
            else
            {
                push = false;
                lazyPull = $("#lazyPull").val();
                if(lazyPull == "true")
                {
                    lazyPull = true;
                    autoClosePull = $("#autoClosePull").val();
                    if(autoClosePull == "true")
                    {
                        autoClosePull = true;
                    }
                    else
                    {
                        autoClosePull = false;
                    }
                }
                else
                {
                    lazyPull = false;
                    autoClosePull = false;
                }

                var url = $("#url").val();
                var urls;
                var arr = new Array();
                var count_url = 0;
                $("#main_body").find(".item").each(function(e) {
                    var url_flag = true;
                    $(this).find("input").each(function (f) {
                        if(f == 0)
                        {
                            urls = $(this).val();
                            if(urls == "")
                            {
                                url_flag = false;
                            }
                        }
                    })
                    var urlInfo = new Urls(urls);
                    if(url_flag)
                    {
                        arr[count_url] = urlInfo;
                        count_url++;
                    }
                })
                var engineId = $("#engineId").val();
                if(engineId == undefined)
                {
                    engineId = "";
                }
                if(arr.length <= 0)
                {
                    pullStream = new PullStreamNoUrls(url,tf_se,engineId);
                }
                else
                {
                    if(url == "")
                    {
                        url = arr[0];
                    }
                    pullStream = new PullStream(url,arr,tf_se,engineId);
                }
                //alert(stringify(pullStream))
            }
            var playDeleay =  parseInt($("#playDeleay").val());
            var tsStatus = live.tsStatus;
            var hlsStatus = live.hlsStatus;
            var enableHLS = $("#enableHLS").val();
            if(enableHLS == "true")
            {
                enableHLS = true;
                hlsStatus = true;
            }
            else
            {
                enableHLS = false;
                hlsStatus = false;
            }
            var enableTS = $("#enableTS").val();
            if(enableTS == "true")
            {
                enableTS = true;
                tsStatus = true;
            }
            else
            {
                enableTS = false;
                tsStatus = false;
            }
            var tsAddress = $("#tsAddress").val();
            var flvKeyframe = parseInt($("#flvKeyframe").val());
            var recordEnabled = $("#recordEnabled").val();
            if(recordEnabled == "true")
            {
                recordEnabled  = true;
            }
            else
            {
                recordEnabled = false;
            }
            var recordType = parseInt($("#recordType").val());
            var intervalTime = parseInt($("#intervalTime").val());
            var splitFileSize = parseInt($("#splitFileSize").val());
            var format = $("#format").val();
            var delaySeconds = parseInt($("#delaySeconds").val());
            var enableRTP= live.enableRTP;
            var forwardUrls= live.forwardUrls;
            var ip = live.ip;
            var liveStatus = live.liveStatus;
            var outputs = live.outputs;
            var playback = live.playback;
            var publishStatus = live.publishStatus;
            var recordStatus = live.recordStatus;
            var replaces = live.replaces;
            var timeToApend = parseInt($("#timeToApend").val());
            var type = live.type;
            var items = live.listItem;
            var transferInfo = live.transferInfo;

            var liveInfo = new LiveChannelInfoEdit(alias,appName,autoClosePull,dataPath,delaySeconds,enableHLS,enableRTP,enableTS,flvKeyframe,format,forwardUrls,hlsStatus,id,intervalTime,ip,keepPlaybackDays,lazyPull,lazyPush,liveProperty,liveStatus,
                    name,outputMode,outputs,playback,publishStatus,push,recordEnabled,recordStatus,recordType,replaces,right,splitFileSize,timeToApend,tsAddress,tsStatus,type,items,pullStream,transferInfo,playDeleay);

            //alert(stringify(liveInfo));
            var flag = true;
            if(push != true)
            {
                if(tf_se == undefined)
                {
                    flag = false;
                    window.top.art.dialog({id:"mesg",content:PleaseSelectTranscodingScheme+"!",time:1});
                }
            }
            if(flag)
            {
                $.ajax({
                    type:"PUT",
                    url:locationHref+"/rest/admin/lives/"+liveId,//编辑一个直播频道
                    async: false,
                    data: stringify(liveInfo),
                    dataType:"json",
                    success:function(data)
                    {
                        window.top.art.dialog({id:'edit'}).close();
                    },
                    error:function(data)
                    {
                        var errorObj = data;
                        var status = data.status;
                        var statusText = data.statusText
                        if(status == 401 || status == 400)
                        {
                            top.location.href = "login.html";
                        }
                    }

                })
            }
        }


        function m_add(obj)
        {
            var content = $("#main_body").find(".item").first().clone();
            $(content).find("input[type='text']").val("");
            //$(content).find("input[type='button']").hide();
            //$(content).find("input[type='text']").removeAttr("readonly");
            //$(content).find("input[name=urls]").css('background-color','');
            $(obj).parent("div").after(content);
        }
        function m_remove(obj)
        {
            var id =  $(obj).parent("div").parent("div").attr("id");
            //if(id != "templ")
            {
                $(obj).parent("div").remove();
            }
        }

        function m_up(obj)
        {
            $(obj).parent("div").insertBefore($(obj).parent("div").prev());
            $(obj).parent("div").find("input").css("color","#990000")
            setTimeout(function(){
                $(obj).parent("div").find("input").css("color","#000")
            },800)
        }
        function m_down(obj)
        {
            $(obj).parent("div").insertAfter($(obj).parent("div").next());

            $(obj).parent("div").find("input").css("color","#990000")
            setTimeout(function(){
                $(obj).parent("div").find("input").css("color","#000")
            },800)
        }

        function checkStream(obj)
        {
            var checkVal = $(obj).parent("div").find("div").find("input").val();
            var array = new Array();
            var urls = new Urls(checkVal);
            array[0] = urls;
            $.ajax({
                type: "POST",
                url: locationHref+"/rest/admin/transfer/checkFile",//检查流是否可以
                async: false,
                data: stringify(array),
                success:function(data)
                {
                    window.top.art.dialog({id:"mesg",content:"流可正常连接!",time:1});
                },
                error:function(data)
                {
                    var errorObj = data;
                    var status = data.status;
                    var statusText = data.msg;
                    if(status == 401 || status == 400)
                    {
                        top.location.href = "login.html";
                    }
                    else if(status == 409)
                    {
                        window.top.art.dialog({id:"mesg",content:statusText+"!",time:1});
                    }
                }
            });
        }

        $(function(){
            $("input[@type=radio][name=transferStatus]").change(function(){
                var pushVal = $("#isPush").val();
                if(pushVal == "false")
                {
                    var id = $(this).attr("id");
                    if(id=="open")
                    {
                        $("#transferPlan").show();
                    }
                    else
                    {
                        $("#transferPlan").hide();
                        $("#tf_select").val("-1");
                    }
                }
                else
                {
                    $("#transferPlan").hide();
                    $("#tf_select").val("-1");
                }
            })
        })
    </script>
<title></title>
</head>
<body>

<form action="" method="post" onsubmit="return check()" >
    <!-- 隐藏字段 -->
    <input type="hidden" id="liveId" name="id" value="" >
    <input type="hidden" name="dialog" value="edit">


    <div class="pad-10">
        <div class="col-tab">
            <ul class="tabBut cu-li">
                <li onclick="SwapTab('setting','on','',5,1);" class="on" id="tab_setting_1">基本配置</li>
                <li onclick="SwapTab('setting','on','',5,2);" class="" id="tab_setting_2" >高级配置</li>
                <li onclick="SwapTab('setting','on','',5,3);" class="" id="tab_setting_3" >录像配置</li>
            </ul>
            <div class="contentList pad-10" id="div_setting_1"><!-- 直播基本配置 -->
                <table width="100%" class="table_form ">
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_1">应用名称：</td>
                        <td align="left" ><input class="input-text" type="text" id="appName" name="appName" size="56" ></td>
                    </tr>
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_2">直播频道名称：</td>
                        <td align="left" ><input class="input-text" type="text" id="liveName" name="liveName" size="56"></td>
                    </tr>
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_3">别名：</td>
                        <td align="left" ><input class="input-text" type="text" id="alias" name="alias" size="56" value=""></td>
                    </tr>
                    <!--<input type="hidden" name="right" id="right"/>-->
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_5">录像存放路径:(格式如:e:/data)
                        <td align="left" >
                            <input class="input-text" type="text" id="dataPath" name="dataPath" size="56" value="e:\data" readonly="readonly">
                            <br/><span id="td_5_1">同一应用名称下(如:live)确保dataPath一致!</span>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="contentList pad-10 hidden" id="div_setting_2"><!-- 直播高级配置 -->
                <table width="100%" class="table_form ">

                    <tr valign="bottom" height="16">
                        <td align="left" id="td_6">子码流创建方式：</td>
                        <td align="left" >
                            <select class="select" size="1" name="outputMode" id="outputMode">
                                <option value="1" id="td_6_1">拉方式</option>
                                <option value="0" id="td_6_2">推方式</option>
                            </select>
                        </td>
                    </tr>
                 <!--   <tbody id="playbackDays_outer">
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_7">回播天数：</td>
                        <td align="left" >
                            <input class="input-text" type="text" id="keepPlaybackDays" name="keepPlaybackDays" size="56" value="7">
                        </td>
                    </tr>
                    </tbody>-->
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_8">流发布方式</td>
                        <td align="left" >
                            <select class="select" size="1" name="liveProperty" id="liveProperty">
                                <option value="0" id="td_8_1">允许推流;允许发布;允许录像</option>
                                <option value="1" id="td_8_2">允许推流;不允许发布;不允许录像</option>
                                <option value="2" id="td_8_3">允许推流;不允许发布;允许录像</option>
                                <option value="3" id="td_8_4">不允许推流;不允许发布;不允许录像</option>
                            </select>
                        </td>
                    </tr>

                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_9">流方式：</td>
                        <td align="left" >
                            <select class="select" size="1" name="isPush" id="isPush" onchange="pull_select(this.value)">
                                <option value="true" id="td_9_1">推方式</option>
                                <option value="false" id="td_9_2">拉方式</option>
                            </select>
                        </td>
                    </tr>

                    <tbody id="pullBody"  style="display: none;">
                        <tr valign="bottom" height="16">
                            <td align="left"  id="td_40">拉流：</td>
                            <td align="left" >
                                <select class="select" size="1" name="lazyPull" id="lazyPull" onchange="select_take_pull(this.value)">
                                    <option value="false" id="td_40_2">立刻启动(拉)</option>
                                    <option value="true" id="td_40_1">客户端接入时启动(拉)</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="pushBody">
                        <tr valign="bottom" height="16">
                            <td align="left"  id="td_50">推流：</td>
                            <td align="left" >
                                <select class="select" size="1" name="lazyPush" id="lazyPush" onchange="select_take(this.value)">
                                    <option value="false" id="td_50_2">立刻启动(推)</option>
                                    <option value="true" id="td_50_1">客户端接入时启动(推)</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>

                    <tbody id="take_body" style="display: none;">
                        <tr valign="bottom" height="16" >
                            <td align="left" id="td_11">流自动关闭</td>
                            <td align="left" >
                                <select class="select" size="1" name="autoClosePull" id="autoClosePull">
                                    <option value="true" id="td_11_1">开启</option>
                                    <option value="false" id="td_11_2">关闭</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>

                    <tbody id="playDeleayTime" style="display: none;">
                        <tr  valign="bottom" height="16">
                            <td align="left" id="td_333">缓冲时间：</td>
                            <td align="left" ><input class="input-text" type="text" id="playDeleay" name="playDeleay" size="56" value="2"></td>
                        </tr>
                    </tbody>


                    <!-- 拉流额外设置 start -->
                    <tbody id="pull_body" style="display: none">
                        <tr  valign="bottom" height="16">
                            <td align="left" id="td_12">主流地址:</td>
                            <td align="left" >
                                <input title="流地址可以是:
                                        rtmp://192.168.1.1:1935/live/live1
                                        rtsp://192.168.1.23
                                        udp://@234.5.6.7:9000
                                        mms://192.168.1.12/live" class="input-text" type="text" id="url" name="url" size="56"  size="56" value="">
                            </td>
                        </tr>
                        <tr valign="bottom" height="16">
                            <td align="left" id="td_url">备用流列表:</td>
                            <td align="left" >
                                <div id="main_body">
                                    <div class="item">
                                        <div class="mystyle" style="display: inline;">
                                            <input title="流地址可以是:
                                                    rtmp://192.168.1.1:1935/live/live1
                                                    rtsp://192.168.1.23
                                                    udp://@234.5.6.7:9000
                                                    mms://192.168.1.12/live" class="input-text" type="text" id="urls" name="urls" size="56" value="">
                                        </div>
                                        <a href='javascript:;' style="display: inline;" class="button" onclick='m_add(this)' title='添加' id="add">+</a>
                                        <a href='javascript:;' style="display: inline;" class="button" onclick='m_remove(this)' title='移除' id="Remove">-</a>
                                        <a href='javascript:;' style="display: inline;" class="button" onclick='m_up(this)' title='上移' id="Upward">U</a>
                                        <a href='javascript:;' style="display: inline;" class="button" onclick='m_down(this)' title='下移' id="down">D</a>
                                        <a href="javascript:;" style="display: inline;" class="button" onclick="checkStream(this)" title="流连接测试" id="check">流连接测试</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td id="transStatus">转码状态</td>
                            <td>
                                <input type="radio" id="open" name="transferStatus" value="true">开启
                                <input type="radio" id="close" name="transferStatus" value="false" checked="checked">关闭
                            </td>
                        </tr>
                        <tbody id="transferPlan" style="background:#DDDDDD;display:none;">
                            <tr>
                                <td>
                                    <span id="transcodingScheme">转码方案 </span> :
                                </td>
                                <td>
                                    <div id="tfServerOuter" style="display:inline;"></div>
                                </td>
                            </tr>
                        </tbody>

                        <tbody id="engineIdBody" style="background:#DDDDDD;display: none;">
                            <tr valign="bottom" height="16">
                                <td align="left">插件：</td>
                                <td align="left" >
                                    <select class="select" size="1" name="engineId" id="engineId" >

                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </tbody>
                    <!-- 拉流额外设置 end -->

                    <tbody id="hls_oper">
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_21">启用HLS</td>
                        <td align="left" >
                            <select class="select" size="1" name="enableHLS" id="enableHLS">
                                <option value="false" id="td_21_1">禁用</option>
                                <option value="true" id="td_21_2">启用</option>
                            </select>
                        </td>
                    </tr>
                    </tbody>
                    <tbody id="ts_oper">
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_22">启用TS</td>
                        <td align="left" >
                            <select class="select" size="1" name="enableTS" id="enableTS">
                                <option value="false" id="td_22_1">禁用</option>
                                <option value="true" id="td_22_2">启用</option>
                            </select>
                        </td>
                    </tr>
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_23">TS地址</td>
                        <td align="left" >
                            <input class="input-text" type="text" name="tsAddress" id="tsAddress" value="234.4.5.6:9000">
                            <span style="color:#990000" id="td_23_1">&nbsp;&nbsp;格式如:234.2.5.7:9000</span>
                        </td>
                    </tr>
                    </tbody>
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_33">延时直播</td>
                        <td align="left" >
                            <input class="input-text" type="text" name="delaySeconds" id="delaySeconds" value="0">
                        </td>
                    </tr>
                </table>
            </div>
            <div class="contentList pad-10 hidden" id="div_setting_3" ><!-- 流录像配置 -->
                <table width="100%" class="table_form">
                    <tr valign="bottom" height="16">
                        <td align="left" width="20%" id="td_24">录制文件处理：</td>
                        <td align="left" >
                            <select class="select" size="1" name="flvKeyframe" id="flvKeyframe">
                                <option value="0" id="td_24_1">不生成索引信息</option>
                                <option value="1" selected="selected" id="td_24_2">边录制边生成索引</option>
                                <option value="2"  id="td_24_3">录制结束后生成索引</option>
                            </select>
                        </td>
                    </tr>
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_25">录像：</td>
                        <td align="left" >
                            <select class="select" name="recordEnabled" id="recordEnabled">
                                <option value="true" selected="selected"  id="td_25_1">允许录像</option>
                                <option value="false" id="td_25_2">不允许录像</option>
                            </select>
                        </td>
                    </tr>

                    <tr id="trHeader" valign="bottom" height="16">
                        <td align="left" id="td_26">录像方式：</td>
                        <td align="left" >
                            <select class="select" size="1" name="recordType" id="recordType">
                                <option value="0" selected="selected"  id="td_26_1">手动</option>
                                <option value="1" id="td_26_2">定时</option>
                                <option value="2" id="td_26_3">当有直播流时自动录像</option>
                            </select>
                        </td>
                    </tr>
                    <tbody id="append_time_outer">
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_28">断流多久内追加:</td>
                        <td align="left" >
                            <input class="input-text" type="text" name="timeToApend" id="timeToApend" value="5">&nbsp;&nbsp;<span id="td_28_1">单位(秒)</span>
                        </td>
                    </tr>
                    </tbody>
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_32">分段方式：</td>
                        <td align="left" >
                            <select class="select" size="1" name="splitRecord" id="splitRecord" onchange="record_type(this.value)">
                                <option value="time" id="td_32_1">时间</option>
                                <option value="much" id="td_32_2">大小</option>
                            </select>
                        </td>
                    </tr>
                    <tbody id="time_type">
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_29">录像文件间隔多久分段:</td>
                        <td align="left" >
                            <input class="input-text" type="text" name="intervalTime" id="intervalTime" value="240">&nbsp;&nbsp;<span id="td_29_1">单位(分)</span>
                        </td>
                    </tr>
                    </tbody>
                    <tbody id="much_type" style="display: none">
                    <tr valign="bottom" height="16">
                        <td align="left" id="td_31">录像文件多大分段:</td>
                        <td align="left" >
                            <input class="input-text" type="text" name="splitFileSize" id="splitFileSize" value="0">&nbsp;&nbsp;<span id="td_31_1">单位(兆)</span>
                        </td>
                    </tr>
                    </tbody>
                    <tr  valign="bottom" height="16">
                        <td align="left" id="td_30" >录像格式：</td>
                        <td align="left" >
                            <select class="select" name="format" id="format">
                                <option value="flv" selected="selected" >FLV</option>
                                <option value="mp4" >MP4</option>
                                <option value="m3u8" >M3U8</option>
                            </select>
                        </td>
                    </tr>

                </table>
            </div>
            <div class="bk15"></div>
            <input type="submit" class="dialog" value="确定" id="dosubmit" name="dosubmit">
        </div>
    </div>
</form>
<!--table_form_off-->

<script language="JavaScript">

    function SwapTab(name,cls_show,cls_hide,cnt,cur){
        for(i=1;i<=cnt;i++){
            if(i==cur){
                $('#div_'+name+'_'+i).show();
                $('#tab_'+name+'_'+i).attr('class',cls_show);
            }else{
                $('#div_'+name+'_'+i).hide();
                $('#tab_'+name+'_'+i).attr('class',cls_hide);
            }
        }
    }
    function load_file_list(id) {
        if(id=='') return false;
        $.getJSON('?m=admin&amp;c=category&amp;a=public_tpl_file_list&amp;style='+id+'&amp;catid=&amp;type=1', function(data){$('#page_template').html(data.page_template);});
    }
    //--&gt;
</script></body>


</html>
