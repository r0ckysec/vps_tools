<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title></title>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">

	<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
	<script type="text/javascript" src="/css/ztree/jquery.ztree.core.js"></script>
	<script type="text/javascript" src="js/add_edit_live.js"></script>
	<script type="text/javascript" src="js/cookie.js"></script>
	<script type="text/javascript" src="js/bean.js"></script>
	<script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
	<script type="text/javascript" src="js/add_edit_live.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="/css/ztree/jquery.ztree.excheck-3.5.js"></script>
	<link rel="stylesheet" href="/css/ztree/zTreeStyle.css" type="text/css">


	<script type="text/javascript">
		var InformationIsNotCorrect ;
		var NoDemandDirectory;
		$(function(){
			Init_license(authorization);
			var Languages = $.cookie('internationalization');

			if ( Languages == null || Languages == "" )
			{
				Languages = 'zh' ;
			}
			jQuery.i18n.properties({
				name : 'strings', //资源文件名称
				path : '/i18n/', //资源文件路径
				mode : 'map', //用Map的方式使用资源文件中的值
				language : Languages,
				encoding : 'UTF-8', // 必须写 否则中文乱码
				callback : function() {//加载成功后设置显示内容
					$('#information').html($.i18n.prop('EssentialInformation'));
					$('#dosubmit').val($.i18n.prop('Determine'));

					InformationIsNotCorrect = $.i18n.prop('InformationIsNotCorrect');
					NoDemandDirectory = $.i18n.prop('NoDemandDirectory');
				}
			});
		});

		(function($){
			$.getUrlParam = function(name)
			{
				var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if (r!=null) return unescape(r[2]); return null;
			}
		})(jQuery);
		var beforeVodTypeId = $.getUrlParam("vodTypeId");
		$(function(){
			init_tree();
		})

		//点播分类
		var setting = {
			check: {
				enable: true,
				chkStyle: "checkbox",
				chkboxType: { "Y": "", "N": "" }
			},
			data: {
				key: {
					name:"name",
					children:"subNames",
					title:"name",
					url:"url"
				}
			}
		};
		var zNodes = new Array();
		function init_tree()
		{
			$.ajax({
				type: "GET",
				async: false,
				url: locationHref+"/rest/admin/vodTypes",
				success: function(data)
				{
					var obj = data;
					if(obj == null)
					{
						window.top.art.dialog({id:"show",content:NoDemandDirectory+"!",time:1});
					}
					var MainCategoryInfo;
					var count = 0;
					for(var i=0;i<obj.length;i++)
					{
						var id = obj[i].id;
						if(id == "" || id.indexOf("lu_") != -1)
						{

						}
						else
						{
							var name = obj[i].name;
							var subNames = obj[i].subNames;
							var subNameInfo = null;
							var url = "";
							var subArray = new Array();
							var flag = false;
							if(subNames != '' && subNames != undefined)
							{
								for(var j=0;j<subNames.length;j++)
								{
									var subid = subNames[j].id;
									var subName = subNames[j].name;
									var suburl = "";
									var subflag = false;
									if(beforeVodTypeId.indexOf(subid) != -1)
									{
										subflag = true;
									}
									subNameInfo = new SubCategory2(subid,subName,suburl,subflag,true);
									subArray[j] = subNameInfo;
								}
							}
							var catOpen = true;
							if(id != "")
							{
								if(beforeVodTypeId.indexOf(id) != -1)
								{
									flag = true;
								}
								MainCategoryInfo = new MainCategoryOpen2(id,name,catOpen,subArray,url,flag,true);
								zNodes[count] = MainCategoryInfo;
								count++;
							}
						}
					}
					$.fn.zTree.init($("#treeDemo"), setting, zNodes);
				},
				error:function()
				{
					parent.location.href = "/login.html";
				}
			})
		}

		$(document).ready(function(){
			var treeObj=$.fn.zTree.getZTreeObj("treeDemo");
			//treeObj.expandAll(true);  展开折叠所有节点  true  false
			//拿到所有树节点
			var nodes = treeObj.transformToArray(treeObj.getNodes());
			//var nodes = treeObj.getNodes();
			//for循环逐个修改树节点属性
			if(nodes != null && nodes != "")
			{
				for(var i = 0;i<nodes.length;i++)
				{
					//更新节点
					treeObj.updateNode(nodes[i]);
				}
			}
		});
	</script>
</head>

<body>

<div class="pad-10">
	<div class="common-form">
			<div style="float: left;width :100%;">
				<ul id="treeDemo" class="ztree"></ul>
			</div>
	</div>
</div>

</body>
</html>
