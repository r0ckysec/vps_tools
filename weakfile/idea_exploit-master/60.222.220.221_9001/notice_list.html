<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">

	<link rel="stylesheet" type="text/css" href="css/common.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link rel="stylesheet" type="text/css" href="css/sp.css" />
	<link rel="stylesheet" type="text/css" href="css/reset.css" />
	<link rel="stylesheet" type="text/css" href="css/system.css" />
	<link rel="stylesheet" type="text/css" href="css/table_form.css" />
	<link rel="stylesheet" type="text/css" href="css/dialog.css" />

	<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
	<script type="text/javascript" src="js/jquery.corner.js"></script>
	<script type="text/javascript" src="js/admin_common.js"></script>
	<script type="text/javascript" src="js/dialog.js"></script>
	<script type="text/javascript" src="js/cookie.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
	<script type="text/javascript" src="js/add_edit_live.js"></script>
	<script type="text/javascript" src="js/bean.js"></script>
	<script type="text/javascript">
		var　BuildingPage ;
		var FailedToGetData ;
		var Delete ;
		var AddOnDemandDirectory ;
		var ExpressionCannotBeAdded ;
		var DeleteMethod ;
		var DeleteOnDemandDirectory ;
		var Edit;
		var NoNotice;
		var AddNewsNotice;
		var EditNewsNotice;
		var DelNewsNotice;
		var LockNotice;
		var UnLockNotice;
		var NoSelectNotice;
		var DoYouLockNotice;
		var DoYouUnLockNotice;
		var currentPage = 1;
		var currentPageCount = 10;
		var InTotal ;// 共
		var Page ;// 页
		var NumberOfData ;// 条数据
		var HomePage;
		var PreviousPage ;
		var NextPage ;
		var Shadowe ;
		$(function(){
			Init_license(authorization);
			var Languages = $.cookie('internationalization');

			if ( Languages == null || Languages == "" )
			{
				Languages = 'zh' ;
			}
			jQuery.i18n.properties({
				name : 'strings', //资源文件名称
				path : '/i18n/', //资源文件路径
				mode : 'map', //用Map的方式使用资源文件中的值
				language : Languages,
				encoding : 'UTF-8', // 必须写 否则中文乱码
				callback : function() {//加载成功后设置显示内容
					$('#addCatalog').html($.i18n.prop('AddNotice'));
					$('#th_1').html($.i18n.prop('SerialNumber'));
					$('#th_2').html($.i18n.prop('Name'));
					$('#th_3').html($.i18n.prop('CreationTime'));
					$('#th_4').html($.i18n.prop('Operation'));
					$('#lockCatalog').html($.i18n.prop('Lock'));
					$('#unlockCatalog').html($.i18n.prop('Unlock'));

					BuildingPage = $.i18n.prop('BuildingPage') ;
					FailedToGetData = $.i18n.prop('FailedToGetData') ;
					Delete = $.i18n.prop('Delete') ;
					AddOnDemandDirectory = $.i18n.prop('AddOnDemandDirectory') ;
					ExpressionCannotBeAdded = $.i18n.prop('ExpressionCannotBeAdded') ;
					DeleteMethod = $.i18n.prop('DeleteMethod') ;
					DeleteOnDemandDirectory = $.i18n.prop('DeleteOnDemandDirectory') ;
					Edit = $.i18n.prop('Edit') ;
					NoNotice = $.i18n.prop('NoNotice');
					AddNewsNotice = $.i18n.prop('AddNewsNotice');
					EditNewsNotice = $.i18n.prop('EditNewsNotice');
					DelNewsNotice = $.i18n.prop('DelNewsNotice');
					LockNotice = $.i18n.prop('LockNotice');
					UnLockNotice = $.i18n.prop('UnLockNotice');
					NoSelectNotice = $.i18n.prop('NoSelectNotice');
					DoYouLockNotice = $.i18n.prop('DoYouLockNotice');
					DoYouUnLockNotice = $.i18n.prop('DoYouUnLockNotice');
					InTotal = $.i18n.prop('InTotal') ;
					Page = $.i18n.prop('Page') ;
					NumberOfData = $.i18n.prop('NumberOfData') ;
					HomePage = $.i18n.prop('HomePage') ;
					PreviousPage = $.i18n.prop('PreviousPage') ;
					NextPage = $.i18n.prop('NextPage') ;
					Shadowe = $.i18n.prop('Shadowe') ;
				}
			});
		});

		$(function(){
			init_notice_page(currentPage,currentPageCount);
		})

		function init_notice_page(currentPage,currentPageCount)
		{
			$("#main_body").empty();

			window.top.art.dialog({id:"wait",content:BuildingPage+"...<img width=20 src='images/loading.gif'>"});
			 $.ajax({
				 type: "GET",
				 async: false,
				 url: locationHref+"/rest/admin/news/"+currentPageCount+"/"+currentPage, //获取所有新闻
				 success: function(data)
				 {
					 var obj = data;
					 var count = 1;
					 if(obj != '')
					 {
						 var items = obj.items;
						 var length = obj.total;
						 if(items != '')
						 {
							 for(var i=0;i<items.length;i++)
							 {
								 var id = items[i].id;
								 var name = items[i].title;
								 var createTime = items[i].time;
								 var del = '<a href="javascript:;" onclick="delDialog(\''+id+'\')" title="'+Delete+'" class="ext_btn_red ext_btn_size">'+Delete+'</a>&nbsp';
								 var edit = '<a href="javascript:;" onclick="editDialog(\''+id+'\')" title="'+Edit+'" class="sp_a_but_cir sp_a_but_padding btn btn-info">'+Edit+'</a>&nbsp';
								 var dom ='<tr >';
								 dom += '<td align="center">';
								 dom += '<input type="checkbox" class="inputcheckbox"  name="mediainfoIds" value="' + id + '">';
								 dom += '</td>';
								 dom+='<td align="center" >'+count+'</td>';
								 dom+='<td align="center" >'+name+'</td>';
								 dom+='<td align="center" >'+createTime+'</td>';
								 dom+='<td align="center">';
								 dom+=''+edit+' '+del+'';
								 dom+='</td>';
								 dom+='</tr>';
								 count++;
								 $("#main_body").append(dom);
							 }
						 }

						 var page = Math.ceil(length/currentPageCount);//共几页
						 var page_dom = '<div class="pager Library_Page" >';
						 page_dom += '<span class="Library_Page_1">'+InTotal+'<font color="red">'+page+'</font>&nbsp;'+Page+',<font color="red">'+length+'</font>'+NumberOfData+'&nbsp;&nbsp;</span>';
						 page_dom += '<a href="javascript:void(0)"  onclick="init_notice_page(1,'+currentPageCount+')">'+HomePage+'</a>';
						 if(currentPage-1>0)
						 {
							 page_dom+='<a href="javascript:void(0)" onclick="init_notice_page('+(currentPage-1)+','+currentPageCount+')">'+PreviousPage+'</a>';
						 }
						 var page_arr = calculatePageIndex(length,page,5);
						 for(var z=page_arr[0];z<=page_arr[1];z++)
						 {
							 if(z == currentPage)
							 {
								 page_dom+='<a href="javascript:void(0)" style="background-color: #3EAFE0" class="Library_Page_NoPage">'+z+'</a>';
							 }
							 else
							 {
								 page_dom+='<a href="javascript:void(0)" onclick="init_notice_page('+z+','+currentPageCount+')" class="Library_Page_NoPage">'+z+'</a>';
							 }
						 }
						 if(currentPage+1<=page)
						 {
							 page_dom+='<a href="javascript:void(0)" onclick="init_notice_page('+(currentPage+1)+','+currentPageCount+')">'+NextPage+'</a>';
						 }
						 page_dom+='<a href="javascript:void(0)" onclick="init_notice_page('+page+','+currentPageCount+')">'+Shadowe+'</a>';
						 page_dom+='</div>';
						 $("#page").html(page_dom);
					 }

				 },
				 error:function(data)
				 {
					 var errorObj = data;
					 var status = data.status;
					 var statusText = data.statusText
					 if(status == 401 || status == 400)
					 {
						 top.location.href = "login.html";
					 }
					 else if(status == 409)
					 {
						 window.top.art.dialog({id:"mesg",content:statusText+"!",time:2});
					 }
				 }
			 })
			 window.top.art.dialog({id:"wait"}).close();
		}

		function calculatePageIndex(currentPage,totalPage,viewPageCount)
		{
			var startPage = 0 ;
			var endPage = 0;
			var arr = new Array();
			// 如果总页面小于 页面 分页显示页数
			if (totalPage <= viewPageCount) {
				startPage = 1;
				endPage = totalPage;
				arr[0] = startPage;
				arr[1] = endPage;

				return arr;
			}

			//计算出中间值
			var n = Math.ceil(viewPageCount/2)-1;
			startPage = currentPage - n;

			//如果当前页己经小于起始页
			if (startPage <= 1) {
				startPage = 1;
				// 因为两个边界的页码数也要显示
				endPage = startPage + (viewPageCount - 1);
				arr[0] = startPage;
				arr[1] = endPage;

				return arr;
			}

			endPage = currentPage + n;

			//前页页面显示的值是积数 还是偶数
			if (viewPageCount % 2 == 0) {
				startPage += 1;
			}
			if (endPage > totalPage) {
				endPage = totalPage;
				// 因为两个边界的页码数也要显示
				startPage = totalPage - (viewPageCount - 1);
			}
			arr[0] = startPage;
			arr[1] = endPage;

			return arr;
		}


		function addDialog()
		{
			window.top.art.dialog
			(
					{
						id:'add',iframe:'add_notice.html', title:AddNewsNotice, width:'850', height:'500', lock:true,window:'top'
					},
					function(){
						var d = window.top.art.dialog({id:'add'}).data.iframe;
						d.addNotice();
						window.top.art.dialog({id:'add'}).close()
						window.location.href='/notice_list.html';
						return false;

					},
					function()
					{
						window.top.art.dialog({id:'add'}).close()
					}
			);void(0);
		}

		function editDialog(id)
		{
			window.top.art.dialog
			(
					{
						id:'edit',iframe:'edit_notice.html?id='+id, title:EditNewsNotice, width:'850', height:'500', lock:true,window:'top'
					},
					function(){
						var d = window.top.art.dialog({id:'edit'}).data.iframe;
						d.editNotice();
						window.top.art.dialog({id:'edit'}).close()
						window.location.href='/notice_list.html';
						return false;
					},
					function()
					{
						window.top.art.dialog({id:'edit'}).close()
					}
			);void(0);
		}

		function delDialog(id)
		{
			window.top.art.dialog
			(
					{
						id:'del',content:DeleteMethod, title:DelNewsNotice,lock:true
					},
					function(){
						delNotice(id);
						window.top.art.dialog({id:'del'}).close()
						window.location.href='/notice_list.html';
						return true;
					},
					function()
					{
						window.top.art.dialog({id:'del'}).close()
					}
			)
		}

		function delNotice(id)
		{
			$.ajax({
				type:"DELETE",
				url: locationHref+"/rest/admin/news/"+id,//删除新闻
				async: false,
				contentType: "application/json; charset=utf-8",
				success:function(data){


				},
				error:function(data)
				{
					var errorObj = data;
					var status = data.status;
					var statusText = data.statusText
					if(status == 401 || status == 400)
					{
						top.location.href = "login.html";
					}
					else if(status == 409)
					{
						window.top.art.dialog({id:"mesg",content:statusText+"!",time:2});
					}
				}
			})
		}


		function checkSelect(name)
		{
			var ids = document.getElementsByName(name);
			var count = 0;
			var str = "";

			for(var i=0;i<ids.length;i++)
			{
				if(ids[i].checked == true)
				{
					count ++;
				}
			}
			if(count == 0)
				return false;
			else
				return true;

		}

		/*function lockDialog()
		{
			if(!checkSelect("mediainfoIds"))
			{
				window.top.art.dialog({id:'dg_test34243', content:NoSelectNotice+'!',time:0.5});
				return false;
			}

			window.top.art.dialog
			(
					{
						id:'lock',content:DoYouLockNotice, title:LockNotice,lock:true
					},
					function(){
						var ids = document.getElementsByName("mediainfoIds");
						var str = "";
						//拼接以ID和@组合而成的字符串
						var count = 0;
						for(var i=0;i<ids.length;i++) {
							//如果多选框没有选中 , 让其选中
							if (ids[i].checked == true && i != 0) {
								str += ids[i].value ;
							}
						}
						str = JSON.parse("["+str+"]");
						//alert(stringify(str));

						$.ajax({
							type: "POST",
							async: false,
							url: locationHref+"/restadmin/notice",
							data: stringify(str),
							success: function(data)
							{
								window.top.art.dialog({id:'lock'}).close()
								window.location.href='/notice_list.html';
								return true;
							 },
							 error:function()
							 {
							 top.location.href = "login.html";
							 }
						})

					},
					function()
					{
						window.top.art.dialog({id:'lock'}).close()
					}
			)

		}

		function unlockDialog()
		{
			if(!checkSelect("mediainfoIds"))
			{
				window.top.art.dialog({id:'dg_test34243', content:NoSelectNotice+'!',time:0.5});
				return false;
			}

			window.top.art.dialog
			(
					{
						id:'lock',content:DoYouUnLockNotice, title:UnLockNotice,lock:true
					},
					function(){
						var ids = document.getElementsByName("mediainfoIds");
						var str = "";
						//拼接以ID和@组合而成的字符串
						var count = 0;
						for(var i=0;i<ids.length;i++) {
							//如果多选框没有选中 , 让其选中
							if (ids[i].checked == true && i != 0) {
								str += ids[i].value ;
							}
						}
						str = JSON.parse("["+str+"]");
						//alert(stringify(str));

						$.ajax({
							type: "POST",
							async: false,
							url: locationHref+"/restadmin/notice",
							data: stringify(str),
							success: function(data)
							{
								window.top.art.dialog({id:'lock'}).close()
								window.location.href='/notice_list.html';
								return true;
							 },
							 error:function()
							 {
							 top.location.href = "login.html";
							 }
						})

					},
					function()
					{
						window.top.art.dialog({id:'lock'}).close()
					}
			)
		}*/
	</script>
	<title></title>
</head>
<body scroll="yes" style="overflow-y: scroll;">

<div class="pad-10">
  <div class="content-menu" > 
	  <a href="javascript:;" onclick="addDialog()" class="ext_btn ext_btn_success" id="addCatalog">添加</a>
	  <!--<a href="javascript:;" onclick="lockDialog()" class="ext_btn ext_btn_success" id="lockCatalog">锁定</a>
	  <a href="javascript:;" onclick="unlockDialog()" class="ext_btn ext_btn_success" id="unlockCatalog">解锁</a>-->
  </div>
  <form name="myform" id="myform" action="" method="post" class="">
    <div class="table-list">
		<table id="tblList" width="100%" border="0" cellpadding="8" cellspacing="0" class="list_table">
			 <thead>
			  <tr>
			    <th width="5%">
				  <input value="" id="check_box" name="mediainfoIds" onclick="selectall('mediainfoIds');" type="checkbox">
			    </th>
			    <th align="center" id="th_1">序号</th>
			    <th align="center" id="th_2">名称</th>
			  	<th align="center" id="th_3">创建时间</th>
				<th align="center" id="th_4">操作</th>
			  </tr>
			</thead>
			<tbody id="main_body">

			</tbody>
		  </table>
    </div><!-- end table-list -->
	<div id="page_body">
		<div style="float: right;" id="page">

		</div>
	</div>
 </form>
</div><!-- end pad-10 -->


</body>
</html>


