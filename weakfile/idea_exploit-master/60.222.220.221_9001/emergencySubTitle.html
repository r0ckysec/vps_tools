<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">

    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/main.css">
    <link href="css/sp.css" rel="stylesheet" type="text/css" />
    <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <link href="css/system.css" rel="stylesheet" type="text/css" />
    <link href="css/table_form.css" rel="stylesheet" type="text/css" />
    <link href="css/spectrum.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/jquery-1.4.1.js"></script>
    <script type="text/javascript" src="js/cookie.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
    <script type="text/javascript" src="js/add_edit_live.js"></script>
    <script type="text/javascript" src="js/bean.js"></script>
    <script type="text/javascript" src="js/spectrum.js"></script>
    <script type="text/javascript" src="js/timeTrans.js"></script>
    <script type="text/javascript">

        $(function(){
            Init_license(authorization);
            var Languages = $.cookie('internationalization');

            if ( Languages == null || Languages == "" )
            {
                Languages = 'zh' ;
            }
            jQuery.i18n.properties({
                name : 'strings', //资源文件名称
                path : '/i18n/', //资源文件路径
                mode : 'map', //用Map的方式使用资源文件中的值
                language : Languages,
                encoding : 'UTF-8', // 必须写 否则中文乱码
                callback : function() {//加载成功后设置显示内容
                    $('#information').html($.i18n.prop('EssentialInformation'));
                    //$('#td_1').html($.i18n.prop('ApplyName'));
                }
            });
        });

        (function($){
            $.getUrlParam = function(name)
            {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r!=null) return unescape(r[2]); return null;
            }
        })(jQuery);
        var before_group_array = $.getUrlParam("gourp");//选中分组数组  只有机顶盒可以操作,devType只能是1
        var before_id = $.getUrlParam("id");
        var before_name = $.getUrlParam("name");

        $(function(){
            $(".basic").spectrum();
            if(before_group_array.length == 1 && before_id != '0')
            {
                $.ajax({
                    type: "GET",
                    url: locationHref+"/rest/admin/termGroup/1/"+before_id+"/getGroup",//获取所有组
                    success: function (data)
                    {
                        var obj = data;
                        if(obj != null)
                        {
                            var subtitle = obj.subtitle;
                            var forcedLiveId = subtitle.forcedLiveId;
                            var time = subtitle.time;
                            var word = subtitle.word;
                            var wordColor = "#"+subtitle.wordColor;
                            var wordSize = subtitle.wordSize;
                            var startTime = subtitle.startTime;

                            if(wordColor != "")
                            {
                                $("#fontColor").val(wordColor);
                            }
                            if(wordSize != "")
                            {
                                $("#fontSize").val(wordSize);
                            }
                            if(word != "")
                            {
                                $("#subWord").val(word);
                            }
                            if(time != "")
                            {
                                $("#subTime").val(time);
                            }
                            if(startTime != "")
                            {
                                $("#subStartTime").val(startTime);
                            }
                        }
                    },
                    error:function(data)
                    {
                        var errorObj = data;
                        var status = data.status;
                        var statusText = data.statusText
                        if(status == 401 || status == 400)
                        {
                            top.location.href = "login.html";
                        }
                    }
                })
            }
        })


        function emergencySubTitle()//字幕
        {
            var fontSize_val = $("#fontSize").val();
            var before_fontColor_val = $("#fontColor").val();
            var fontColor_val = before_fontColor_val.substr(1,before_fontColor_val.length);
            var subTime_val = $("#subTime").val();
            var subWord_val = $("#subWord").val();
            var subStartTime_val = $("#subStartTime").val();
            if(before_group_array != "" || before_group_array != null)
            {
                var group_arr = before_group_array.split(",");
                if(group_arr != "" || group_arr != null)
                {
                    var count = 0;
                    var group_array_final = new Array();
                    for(var i=0;i<group_arr.length;i++)
                    {
                        var groupId = group_arr[i];
                        if(groupId == "-1" || groupId == "0")
                        {

                        }
                        else
                        {
                            group_array_final[count] = groupId;
                            count++;
                        }
                    }
                    //alert(stringify(group_array_final))

                    var subTitleApkAll = new SubTitleApkAll(subWord_val,fontSize_val,fontColor_val,subStartTime_val,subTime_val);
                    var apkSubTitle = new ApkSubTitle(group_array_final,subWord_val,fontSize_val,fontColor_val,subStartTime_val,subTime_val);

                    if(group_arr.indexOf('-1') != -1)//包含 所有分组
                    {
                        $.ajax({
                            type: "PUT",
                            url: locationHref+"/rest/admin/termGroup/setWord/all",//设置全部分组字幕
                            async: false,
                            data:stringify(subTitleApkAll),
                            success: function (data)
                            {

                            },
                            error:function(data)
                            {
                                var errorObj = data;
                                var status = data.status;
                                var statusText = data.statusText
                                if(status == 401 || status == 400)
                                {
                                    top.location.href = "login.html";
                                }
                            }
                        })
                    }
                    else //多个分组
                    {
                        $.ajax({
                            type: "PUT",
                            url: locationHref+"/rest/admin/termGroup/setWord/groups",//设置全部分组字幕
                            async: false,
                            data:stringify(apkSubTitle),
                            success: function (data)
                            {

                            },
                            error:function(data)
                            {
                                var errorObj = data;
                                var status = data.status;
                                var statusText = data.statusText
                                if(status == 401 || status == 400)
                                {
                                    top.location.href = "login.html";
                                }
                            }
                        })
                    }
                }
            }
        }

        function getCurrentTimeMMS()
        {
            var date = new Date();
            var month = zeroFill(date.getMonth() + 1);//月
            var day = zeroFill(date.getDate());//日
            var hour = zeroFill(date.getHours());//时
            var minute = zeroFill(date.getMinutes());//分
            var second = zeroFill(date.getSeconds());//秒

            //当前时间
            var curTime =  hour + ":" + minute + ":" + second;
            $("#subStartTime").val(curTime);
        }
    </script>
</head>

<body>

<div class="pad-10">
    <div class="common-form">
        <form id="myform" method="post" action="" name="myform">
            <input type="hidden" name="dialog" value="add">
            <fieldset>
                <legend id="information">基本信息</legend>
                <table width="100%" class="table_form">
                    <tbody>
                        <tr>
                            <td width="80" id="td_1">字幕大小</td>
                            <td>
                                <input type="text" id="fontSize" class="input-text" name="fontSize" value="50">
                            </td>
                        </tr>
                        <tr>
                            <td width="80" id="">字幕颜色</td>
                            <td>
                                <input type="color" id="fontColor" class="input-text" name="fontColor" value="">
                            </td>
                        </tr>
                        <tr>
                            <td width="80" id="">字幕开始时间</td>
                            <td>
                                <input type="text" id="subStartTime" class="input-text" name="subStartTime" value="00:00:00" onclick="getCurrentTimeMMS()"><span style="color: red;">格式:00:00:00</span>
                            </td>
                        </tr>
                        <tr>
                            <td width="80" id="">字幕持续时间</td>
                            <td>
                                <input type="text" id="subTime" class="input-text" name="subTime" value="00:00:00"><span style="color: red;">格式:00:00:00</span>
                            </td>
                        </tr>
                        <tr>
                            <td width="80" id="">字幕内容</td>
                            <td>
                                <textarea style="resize: none;width:400px;height:150px;"id="subWord" name="subWord" value=""></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
            <input type="submit" class="dialog" value="确定" id="dosubmit" name="dosubmit">
        </form>
    </div>
</div>

</body>
</html>
