<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>添加转码方案</title>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<link href="/css/sp.css" rel="stylesheet" type="text/css" />
	<link href="/css/reset.css" rel="stylesheet" type="text/css" />
	<link href="/css/system.css" rel="stylesheet" type="text/css" />
	<link href="/css/table_form.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="/js/jquery-1.4.1.js"></script>
	<script type="text/javascript" src="/js/formvalidator.js"></script>
	<script type="text/javascript" src="/js/formvalidatorregex.js"></script>
	<script type="text/javascript" src="js/cookie.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/jquery.i18n.properties-1.0.9.js"></script>
	<script type="text/javascript" src="js/add_edit_live.js"></script>
	<script type="text/javascript" src="js/bean.js"></script>
	<script type="text/javascript" src="js/changStatus.js"></script>
	<script type="text/javascript">
		$(function(){
			Init_license(authorization);
			var Languages = $.cookie('internationalization');

			if ( Languages == null || Languages == "" )
			{
				Languages = 'zh' ;
			}
			jQuery.i18n.properties({
				name : 'strings', //资源文件名称
				path : '/i18n/', //资源文件路径
				mode : 'map', //用Map的方式使用资源文件中的值
				language : Languages,
				encoding : 'UTF-8', // 必须写 否则中文乱码
				callback : function() {//加载成功后设置显示内容
					$('#information').html($.i18n.prop('EssentialInformation'));
					$('#td_1').html($.i18n.prop('SchemeName'));
					$('#td_2').html($.i18n.prop('ResolvingPower'));
					$('#td_2_1').html($.i18n.prop('Custom'));
					$('#td_3').html($.i18n.prop('FrameRate'));
					$('#td_3_1').html($.i18n.prop('Custom'));
					$('#td_4').html($.i18n.prop('VideoTranscoding'));
					$('#td_4_1').html($.i18n.prop('Open'));
					$('#td_4_2').html($.i18n.prop('Close'));
					$('#td_5').html($.i18n.prop('VideoBitRate'));
					$('#td_6').html($.i18n.prop('AudioTurn'));
					$('#td_6_1').html($.i18n.prop('Open'));
					$('#td_6_2').html($.i18n.prop('Close'));
					$('#td_7').html($.i18n.prop('SamplingRate'));
					$('#td_8').html($.i18n.prop('AudioBitRate'));
					$('#td_9').html($.i18n.prop('Channels'));

					$("#td_preset").html($.i18n.prop('PreSet'));
					$("#td_tune").html($.i18n.prop('Tune'));
					$("#td_profile").html($.i18n.prop('Profile'));
					$("#film").html($.i18n.prop('Film'));
					$("#animation").html($.i18n.prop('Animation'));
					$("#grain").html($.i18n.prop('Grain'));
					$("#stillimage").html($.i18n.prop('Stillimage'));
					$("#psnr").html($.i18n.prop('Psnr'));
					$("#ssim").html($.i18n.prop('Ssim'));
					$("#astdecode").html($.i18n.prop('Astdecode'));
					$("#zerolatency").html($.i18n.prop('Zerolatency'));
				}
			});
		});


		$(function(){
			$("#frameRate").change(function(){
				if(parseInt($(this).val()) == -1)
					$("#custom_frameRate_outer").css("display","inline");
				else
					$("#custom_frameRate_outer").css("display","none");
			})
			$("#resolution").change(function(){
				if(parseInt($(this).val()) == -1)
					$("#custom_resolution_outer").css("display","inline");
				else
					$("#custom_resolution_outer").css("display","none");
			})

			$("#vBitRate").change(function(){
				if(parseInt($(this).val()) == -1)
					$("#custom_vBitRate_outer").css("display","inline");
				else
					$("#custom_vBitRate_outer").css("display","none");
			})

			$.formValidator.initConfig({autotip:true,formid:"myform",onerror:function(msg){}});
			$("#name").formValidator({onshow:"请输入方案名称",onfocus:"方案名称应该为2-10位之间"}).inputValidator({min:2,max:10,onerror:"方案名称应该为2-10位之间"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"方案名称格式错误"});
			//$("#custom_bitRate").formValidator({onshow:"请输入码率",onfocus:"码率应该为1-10位之间"}).inputValidator({min:1,max:10,onerror:"码率应该为1-10位之间"}).regexValidator({regexp:"intege",datatype:"enum",onerror:"码率输入错误!"});
			//$("#custom_width").formValidator({onshow:"请输入分辨率",onfocus:"分辨率应该为数值"}).inputValidator({min:1,max:10,onerror:"分辨率应该为数值"}).regexValidator({regexp:"intege",datatype:"enum",onerror:"分辨率输入错误!"});
			//$("#custom_height").formValidator({onshow:"请输入分辨率",onfocus:"分辨率应该为数值"}).inputValidator({min:1,max:10,onerror:"分辨率应该为数值"}).regexValidator({regexp:"intege",datatype:"enum",onerror:"分辨率输入错误!"});
			//$("#custom_frameRate").formValidator({onshow:"请输入帧率",onfocus:"帧率应该为数值"}).inputValidator({min:1,max:10,onerror:"帧率应该为数值"}).regexValidator({regexp:"intege",datatype:"enum",onerror:"帧率输入错误!"});

			//$("#vBitRate").formValidator({onshow:"请输入视频比特率",onfocus:"视频比特率为数字"}).inputValidator({min:2,max:30,onerror:"视频比特率长度错误"}).regexValidator({regexp:"intege1",datatype:"enum",onerror:"视频比特率格式错误"});
			$("#gop").formValidator({onshow:"请输入视频GOP",onfocus:"GOP为数字"}).inputValidator({min:1,max:10,onerror:"GOP长度错误"}).regexValidator({regexp:"intege1",datatype:"enum",onerror:"GOP格式错误"});
			//$("#sampleRate").formValidator({onshow:"请输入音频采样率",onfocus:"音频采样率为数字"}).inputValidator({min:2,max:10,onerror:"视频比特率长度错误"}).regexValidator({regexp:"intege1",datatype:"enum",onerror:"音频采样率格式错误"});
			//$("#aBitRate").formValidator({onshow:"请输入音频比特率",onfocus:"音频比特率为数字"}).inputValidator({min:2,max:30,onerror:"视频比特率长度错误"}).regexValidator({regexp:"intege1",datatype:"enum",onerror:"音频比特率格式错误"});
			$("#channel").formValidator({onshow:"请输入声道数",onfocus:"声道数为数字"}).inputValidator({min:1,max:10,onerror:"声道数长度错误"}).regexValidator({regexp:"intege1",datatype:"enum",onerror:"声道数格式错误"});
		});

		function addTransfer()
		{
			var valia_flag = $.formValidator.pageIsValid('1');
			if(valia_flag == false)
			{
				return false;
			}

			var name = $("#name").val();
			var resolution = $("#resolution").val();
			var width = "";
			var height = "";
			if(resolution == -1 || resolution == "-1")
			{
				width = parseInt($("#custom_width").val());
				height = parseInt($("#custom_height").val());
			}
			else
			{
				width = parseInt(resolution.substr(0,resolution.indexOf("x")));
				height = parseInt(resolution.substr(resolution.indexOf("x")+1,resolution.length));
			}
			var frameRate = $("#frameRate").val();;
			if(frameRate == -1 || frameRate == "-1")
			{
				frameRate = parseInt($("#custom_frameRate").val());
			}
			else
			{
				frameRate = parseInt($("#frameRate").val());
			}
			var vTransfer = $("#vtransfer").val();
			if(vTransfer == "true")
			{
				vTransfer = true;
			}
			else
			{
				vTransfer = false;
			}
			var vBitRate = parseInt($("#vBitRate").val());
			if(vBitRate == -1 || vBitRate == "-1")
			{
				vBitRate = parseInt($("#custom_vBitRate").val());
			}
			else
			{
				vBitRate = parseInt($("#vBitRate").val());
			}
			var gop = parseInt($("#gop").val());
			var aTransfer = $("#atransfer").val();
			if(aTransfer == "true")
			{
				aTransfer = true;
			}
			else
			{
				aTransfer = false;
			}
			var sampleRate = parseInt($("#sampleRate").val());
			var aBitRate = parseInt($("#aBitRate").val());
			var channel = parseInt($("#channel").val());

			var preset = $("#preset").val();
			var tune = $("#tune").val();
			var profile = $("#profile").val();
			var vparamInfo = new VPrarm(preset,tune,profile);

			var info = new TransferInfo(name,width,height,frameRate,vTransfer,vBitRate,gop,aTransfer,sampleRate,aBitRate,channel,vparamInfo);
			$.ajax({
				type: "POST",
				url: locationHref+"/rest/admin/transfer/transferPlan",//添加转码方案
				async: false,
				data: stringify(info),
				success:function(data)
				{

				},
				error:function(data)
				{
					var errorObj = data;
					var status = data.status;
					var statusText = data.statusText
					if(status == 401 || status == 400)
					{
						top.location.href = "login.html";
					}
				}


			});
			return true;
		}
	</script>
</head>

<body>

<div class="pad-10">
<div class="common-form">
	<form id="myform" method="post" action="" name="myform">
		<fieldset>
			<legend id="information">基本信息</legend>
			<table width="100%" class="table_form">
				<tbody>
					<tr>
						<td width="80" id="td_1">方案名称</td>
						<td><input type="text" id="name" class="input-text" name="name" value="" required="required"></td>
					</tr>
					<tr>
						<td width="80" id="td_2">分辨率 </td>
						<td>
							<select name="resolution" id="resolution">
								<!--<option value="1">原视频分辨率</option>-->
								<option value="1920x1080">1920x1080</option>
								<option value="1280x720">1280x720</option>
								<option value="720x576">720x576</option>
								<option value="720x480">720x480</option>
								<option value="640x480">640x480</option>
								<option value="640x360">640x360</option>
								<option value="480x320">480x320</option>
								<option value="480x272">480x272</option>
								<option value="352x288">352x288</option>
								<option value="352x248">352x248</option>
								<option value="-1" id="td_2_1">自定义</option>
							</select>
							<div id="custom_resolution_outer" style="display: none">
								<input type="text" class="input-text" size="3" id="custom_width"  name="custom_width" value="0"/>x
								<input type="text" class="input-text" size="3" id="custom_height" name="custom_height" value="0"/>
							</div>
						</td>
					</tr>
					<tr>
						<td width="80" id="td_3">帧率</td>
						<td>
							<select name="frameRate" id="frameRate">
								<option value="12">12</option>
								<option value="15">15</option>
								<option value="20">20</option>
								<option value="24">24</option>
								<option value="25" selected="selected">25</option>
								<option value="29">29</option>
								<option value="-1" id="td_3_1">自定义</option>
							</select>
							<div id="custom_frameRate_outer" style="display: none">
								<input type="text" class="input-text" size="3" id="custom_frameRate"  name="custom_frameRate" value="0"/>
							</div>
						</td>
					</tr>
					<tr>
						<td width="80" id="td_4">视频开启转码：</td>
						<td>
							<select class="select" size="1" name="vtransfer" id="vtransfer" onchange="transferVideoChange(this)">
								<option value="true" id="td_4_1">开启</option>
								<option value="false" id="td_4_2">关闭</option>
							</select>
							<!--<input type="button" class="button" name="vParam" id="vParam" style="display: none;" onclick="setVparam()" value="高级配置">-->
						</td>
					</tr>
					<tbody id="transferSet" style="background-color: #f7f7f7;">
						<tr>
							<td width="80" id="td_preset">编码速度：</td>
							<td>
								<select class="select" size="1" name="preset" id="preset">
									<option value="ultrafast" >ultrafast</option>
									<option value="superfast" >superfast</option>
									<option value="veryfast" >veryfast</option>
									<option value="faster" >faster</option>
									<option value="fast" >fast</option>
									<option value="medium" >medium</option>
									<option value="slow" >slow</option>
									<option value="slower" >slower</option>
									<option value="veryslow" >veryslow</option>
									<option value="placebo" >placebo</option>
								</select>
							</td>
						</tr>
						<tr>
							<td width="80" id="td_tune">视觉优化参数：</td>
							<td>
								<select class="select" size="1" name="tune" id="tune">
									<option value="film" id="film">电影</option>
									<option value="animation" id="animation">动画</option>
									<option value="grain" id="grain">保留大量的grain</option>
									<option value="stillimage" id="stillimage">静态图像编码</option>
									<option value="psnr" id="psnr">提高psnr优化参数</option>
									<option value="ssim" id="ssim">提高ssim优化参数</option>
									<option value="astdecode" id="astdecode">快速解码的参数</option>
									<option value="zerolatency" id="zerolatency">零延迟</option>
								</select>
							</td>
						</tr>
						<tr>
							<td width="80" id="td_profile">编码等级：</td>
							<td>
								<select class="select" size="1" name="profile" id="profile">
									<option value="baseline" >baseline</option>
									<option value="main" >main</option>
									<option value="high" >high</option>
								</select>
							</td>
						</tr>
					</tbody>
					<tr>
						<td width="80" id="td_5">视频比特率：</td>
						<td>
							<!--<input type="text" id="vBitRate" value="1024000" class="input-text" name="vbitRate">-->
							<select id="vBitRate" size="1">
								<option value="256000">256000</option>
								<option value="384000">384000</option>
								<option value="512000">512000</option>
								<option value="1024000">1024000</option>
								<option value="2048000">2048000</option>
								<option value="4096000">4096000</option>
								<option value="-1">自定义</option>
							</select>
							<div id="custom_vBitRate_outer" style="display: none">
								<input type="text" class="input-text" size="3" id="custom_vBitRate"  name="custom_vBitRate" value="0"/>
							</div>
						</td>
					</tr>
					<tr>
						<td width="80">GOP：</td> <td><input type="text" id="gop" value="50" class="input-text" name="gop"></td>
					</tr>
					<tr>
						<td width="80" id="td_6">音频开启转码：</td>
						<td>
							<select class="select" size="1" name="atransfer" id="atransfer">
								<option value="true" id="td_6_1">开启</option>
								<option value="false" id="td_6_2">关闭</option>
							</select>
						</td>
					</tr>
					<tr>
						<td width="80" id="td_7">采样率：</td>
						<td>
							<!--<input type="text" id="sampleRate" value="44100" class="input-text" name="sampleRate">-->
							<select id="sampleRate" size="1">
								<option value="0">不变</option>
								<option value="44100">44100</option>
								<option value="48000">48000</option>
							</select>
						</td>
					</tr>
					<tr>
						<td width="80" id="td_8">音频比特率：</td>
						<td>
							<!--<input type="text" id="aBitRate" value="128000" class="input-text" name="abitRate">-->
							<select id="aBitRate" size="1">
								<option value="32000">32000</option>
								<option value="64000">64000</option>
								<option value="128000">128000</option>
								<option value="256000">256000</option>
								<option value="384000">384000</option>
							</select>
						</td>
					</tr>
					<tr>
						<td width="80" id="td_9">声道数：</td> <td><input type="text" id="channel" value="2" class="input-text" name="channel"></td>
					</tr>
				</tbody>
			</table>
		</fieldset>
  
   		<input type="submit" class="dialog" value="确定" id="submit" name="submit" onclick="addTransfer()">
	<!--<a href="#" class=" sp_but_cir sp_but_padding btn btn-info" >取消</a>-->
	</form>
</div>
</div>

</body>
</html>
